#!/bin/sh

if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
#set -u  # force better programming and ability to use check for not set

usage1="
ecmd start   [--ping]
ecmd ping    [timeout_seconds]
ecmd qping   [timeout_seconds]
ecmd stop    [--just server --xterm server ]
ecmd restart [--just server --xterm server ]

ecmd encp    --queue [--verbose=] hostname
"
usage2="
ecmd bfids   
ecmd bfid    bfid

ecmd vols   
ecmd vol     external_label
ecmd addvol  library file_family media_type  volume_name, volume_byte_capacity remaining_capacity
ecmd delvol  volume_name
ecmd clrvol  volume_name
ecmd rdovol  volume_name
ecmd noavol  volume_name
ecmd newlib  volume_name new_library_name


ecmd Estart   farmlet  global Enstore start   on all farmlet nodes
ecmd Estop    farmlet  global Enstore stop    on all farmlet nodes
ecmd Erestart farmlet  global Enstore restart on all farmlet nodes
ecmd emass             lists the current mount state and queue list on the emass robot
ecmd Esys     farmlet  global "enstore-associated" ps on all farmlet nodes

"
if [ -z "${1-}" ] ; then
  cmd="help"
else
  cmd=$1
  shift
fi

stat=0

case $cmd in
  start|enstore-start)
    $ENSTORE_DIR/bin/enstore-start "$@"
    stat=$?
    ;;
  ping)
    $ENSTORE_DIR/bin/enstore-ping "$@"
    stat=$?
    ;;
  qping)
    $ENSTORE_DIR/bin/quick-ping "$@"
    stat=$?
    ;;
  stop|enstore-stop)
    $ENSTORE_DIR/bin/enstore-stop "$@"
    stat=$?
    ;;
  restart)
    $ENSTORE_DIR/bin/enstore-stop "$@"
    $ENSTORE_DIR/bin/enstore-start --nocheck "$@"
    ;;

  encp)
    python $ENSTORE_DIR/src/encp.py                   --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  config|econ)
    python $ENSTORE_DIR/src/configuration_client.py   --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  fcc)
    python $ENSTORE_DIR/src/file_clerk_client.py      --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;
  bfids)
    python $ENSTORE_DIR/src/file_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --bfids $@
    stat=$?
    ;;
  bfid)
    python $ENSTORE_DIR/src/file_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --bfid=$@
    stat=$?
    ;;

  vcc)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;
  addvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --addvol $@
    stat=$?
    ;;
  delvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --delvol $@
    stat=$?
    ;;
  clrvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --clrvol $@
    stat=$?
    ;;
  rdovol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --rdovol $@
    stat=$?
    ;;
  noavol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --noavol $@
    stat=$?
    ;;
  newlib)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --newlib $@
    stat=$?
    ;;
  vols)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --vols $@
    stat=$?
    ;;
  vol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --vol=$@
    stat=$?
    ;;

  lmc)
    python $ENSTORE_DIR/src/library_manager_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  acc)
    python $ENSTORE_DIR/src/admin_clerk_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  mcc)
    python $ENSTORE_DIR/src/media_changer_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  mov)
    python $ENSTORE_DIR/src/mover_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  log)
    python $ENSTORE_DIR/src/log_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  ala)
    python $ENSTORE_DIR/src/alarm_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  inq)
    python $ENSTORE_DIR/src/inquisitor_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  Estart)
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "$ENSTORE_DIR/sbin/estart"
    stat=$?
    ;;

  Estop)
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "$ENSTORE_DIR/sbin/estop"    
    stat=$?
    ;;

  Erestart)
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "$ENSTORE_DIR/sbin/erestart'" 
    stat=$?
    ;;

  emass)
    rsh rip1 "$ENSTORE_DIR/sbin/egrau"    
    stat=$?
    ;;

  Esys)
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "ps auxww | egrep 'python|ecmd|encp|reader|writer|dasadmin|mt '" 
    stat=$?
    ;;

  *)
    echo "Getting help lines, one moment please....\n\n"
    usage="
$usage1
ecmd encp `ecmd encp --usage_line`

ecmd config `ecmd config --usage_line`

ecmd fcc `ecmd fcc --usage_line`

ecmd vcc `ecmd vcc --usage_line`

ecmd lmc `ecmd lmc --usage_line`

ecmd mcc `ecmd mcc --usage_line`

ecmd mov `ecmd mov --usage_line`

ecmd log `ecmd log --usage_line`

ecmd inq `ecmd inq --usage_line`
$usage2
"
    echo "$usage"
    stat=$?
    if [ "$cmd" != "help" ]; then stat=1; fi;

esac

exit $stat

