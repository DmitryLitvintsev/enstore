#!/bin/sh

if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
#set -u  # force better programming and ability to use check for not set

usage="
ecmd start   [--ping]
ecmd ping    [timeout_seconds]
ecmd qping   [timeout_seconds]
ecmd stop    [--just server --xterm server ]
ecmd restart [--just server --xterm server ]

ecmd encp    [--verbose= --help ] inputfilename outputfilename
ecmd encp    --queue [--verbose=] hostname

ecmd config  [--server_verbose= --config_file=  --dict --load --verbose= --alive --help ]
ecmd fcc     [--server_verbose= --bfids --bfid= --verbose= --alive --backup --help ]
ecmd vcc     [--server_verbose= --vols  --vol=  --verbose= --alive --backup --help ']
ecmd lmc     [--server_verbose= --getwork --verbose= --alive --help '] library
ecmd mcc     [--server_verbose= --verbose= --alive --help ']  media_changer volume drive
ecmd mov     [--server_verbose= --verbose= --status --alive --help'] mover
ecmd log     [--server_verbose= --test --alive  --verbose= --logit --help]
ecmd inq     [--server_verbose= --alive --refresh=secs --get_refresh --update --timeout=secs --get_timeout --reset_timeout --timestamp --max_ascii_size --get_max_ascii_size --dump --help]

ecmd bfids   
ecmd bfid    bfid

ecmd vols   
ecmd vol     external_label
ecmd addvol  library file_family media_type  volume_name, volume_byte_capacity remaining_capacity
ecmd delvol  volume_name
ecmd clrvol  volume_name
ecmd rdovol  volume_name
ecmd noavol  volume_name
ecmd newlib  volume_name new_library_name
"

if [ -z "${1-}" ] ; then
  echo "$usage"; exit 1;
else
  cmd=$1
  shift
fi

stat=0

case $cmd in
  start|enstore-start)
    $ENSTORE_DIR/bin/enstore-start "$@"
    stat=$?
    ;;
  ping)
    $ENSTORE_DIR/bin/enstore-ping "$@"
    stat=$?
    ;;
  qping)
    $ENSTORE_DIR/bin/quick-ping "$@"
    stat=$?
    ;;
  stop|enstore-stop)
    $ENSTORE_DIR/bin/enstore-stop "$@"
    stat=$?
    ;;
  restart)
    $ENSTORE_DIR/bin/enstore-stop "$@"
    $ENSTORE_DIR/bin/enstore-start --nocheck "$@"
    ;;

  encp)
    python $ENSTORE_DIR/src/encp.py                   --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  config|econ)
    python $ENSTORE_DIR/src/configuration_client.py   --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  fcc)
    python $ENSTORE_DIR/src/file_clerk_client.py      --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;
  bfids)
    python $ENSTORE_DIR/src/file_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --bfids $@
    stat=$?
    ;;
  bfid)
    python $ENSTORE_DIR/src/file_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --bfid=$@
    stat=$?
    ;;

  vcc)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;
  addvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --addvol $@
    stat=$?
    ;;
  delvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --delvol $@
    stat=$?
    ;;
  clrvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --clrvol $@
    stat=$?
    ;;
  rdovol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --rdovol $@
    stat=$?
    ;;
  noavol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --noavol $@
    stat=$?
    ;;
  newlib)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --newlib $@
    stat=$?
    ;;
  vols)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --vols $@
    stat=$?
    ;;
  vol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --vol=$@
    stat=$?
    ;;

  lmc)
    python $ENSTORE_DIR/src/library_manager_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  acc)
    python $ENSTORE_DIR/src/admin_clerk_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  mcc)
    python $ENSTORE_DIR/src/media_changer_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  mov)
    python $ENSTORE_DIR/src/mover_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  log)
    python $ENSTORE_DIR/src/log_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;


  inq)
    python $ENSTORE_DIR/src/inquisitor_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;


  help)
    echo "$usage"
    stat=$?
    ;;
  *)
    echo "$usage"
    stat=1

esac

exit $stat

