#!/bin/sh

if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
#set -u  # force better programming and ability to use check for not set

usage1="
ecmd start   [--ping]
ecmd ping    [timeout_seconds]
ecmd qping   [timeout_seconds]
ecmd stop    [--just server --xterm server ]
ecmd restart [--just server --xterm server ]

ecmd encp    --queue [--verbose=] hostname
"
usage2="
ecmd bfids   
ecmd bfid    bfid

ecmd vols   
ecmd vol     external_label
ecmd addvol  library file_family media_type  volume_name, volume_byte_capacity remaining_capacity
ecmd delvol  volume_name
ecmd restorevol  volume_name
ecmd clrvol  volume_name
ecmd statvol  volume_name
ecmd rdovol  volume_name
ecmd noavol  volume_name
ecmd newlib  volume_name new_library_name


ecmd Estart   farmlet  global Enstore start   on all farmlet nodes
ecmd Estop    farmlet  global Enstore stop    on all farmlet nodes
ecmd Erestart farmlet  global Enstore restart on all farmlet nodes
ecmd emass             lists the current mount state and queue list on the emass robot
ecmd Esys     farmlet  global "enstore-associated" ps on all farmlet nodes

"
if [ -z "${1-}" ] ; then
  cmd="help"
else
  cmd=$1
  shift
fi

stat=0

case $cmd in
  start|enstore-start)
    $ENSTORE_DIR/bin/enstore-start "$@"
    stat=$?
    ;;
  ping)
    $ENSTORE_DIR/bin/enstore-ping "$@"
    stat=$?
    ;;
  qping)
    $ENSTORE_DIR/bin/quick-ping "$@"
    stat=$?
    ;;
  stop|enstore-stop)
    $ENSTORE_DIR/bin/enstore-stop "$@"
    stat=$?
    ;;
  restart)
    $ENSTORE_DIR/bin/enstore-stop "$@"
    $ENSTORE_DIR/bin/enstore-start --nocheck "$@"
    ;;

  encp)
    python $ENSTORE_DIR/src/encp.py                   --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  cc|configuration_client)
    python $ENSTORE_DIR/src/configuration_client.py   --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  fcc|file_clerk_client)
    python $ENSTORE_DIR/src/file_clerk_client.py      --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;
  bfids)
    python $ENSTORE_DIR/src/file_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --bfids $@
    stat=$?
    ;;
  bfid)
    python $ENSTORE_DIR/src/file_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --bfid=$@
    stat=$?
    ;;

  vcc|volume_clerk_client)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  backup)
    python $ENSTORE_DIR/src/backup.py  $@ 
    stat=$?
    ;;

  addvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --addvol $@
    stat=$?
    ;;
  delvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --delvol $@
    stat=$?
    ;;
  restorevol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --restorevol $@
    stat=$?
    ;;
  clrvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --clrvol $@
    stat=$?
    ;;
  statvol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --statvol=$@
    stat=$?
    ;;
  rdovol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --rdovol $@
    stat=$?
    ;;
  noavol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --noavol $@
    stat=$?
    ;;
  newlib)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --newlib $@
    stat=$?
    ;;
  vols)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --vols $@
    stat=$?
    ;;
  vol)
    python $ENSTORE_DIR/src/volume_clerk_client.py    --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT --vol=$@
    stat=$?
    ;;

  lmc|library_manager_client)
    python $ENSTORE_DIR/src/library_manager_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  mcc|media_changer_client)
    python $ENSTORE_DIR/src/media_changer_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  mvc|mover)
    python $ENSTORE_DIR/src/mover_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  lc|log_client)
    python $ENSTORE_DIR/src/log_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  ac|alarm_client)
    python $ENSTORE_DIR/src/alarm_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  ic|inquisitor_client)
    python $ENSTORE_DIR/src/inquisitor_client.py --config_host=$ENSTORE_CONFIG_HOST --config_port=$ENSTORE_CONFIG_PORT $@
    stat=$?
    ;;

  Estart)
    #if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "$ENSTORE_DIR/sbin/estart"
    # different mount point on fntt - hack in for now, this is bad.
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "~bakken/enstore/sbin/estart"
    stat=$?
    ;;

  Estop)
    #if [ -z "${1-}" ] ; then farmlet=enstore-down; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "$ENSTORE_DIR/sbin/estop"
    # different mount point on fntt - hack in for now, this is bad.
    if [ -z "${1-}" ] ; then farmlet=enstore-down; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "~bakken/enstore/sbin/estop"
    stat=$?
    ;;

  Erestart)
    #if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "$ENSTORE_DIR/sbin/erestart" 
    # different mount point on fntt - hack in for now, this is bad.
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet "~bakken/enstore/sbin/erestart" 
    stat=$?
    ;;

  emass)
    rsh rip1 "$ENSTORE_DIR/sbin/egrau"    
    stat=$?
    ;;

  Esys)
    # yes, I need 3 \'s because of all the durn evals
    if [ -z "${1-}" ] ; then farmlet=enstore; else farmlet=$1; fi; /usr/local/bin/rgang $farmlet \
	"if   [ \\\`uname\\\` = Linux ]; then ps auxww |  egrep 'python|ecmd|encp|reader|writer|dasadmin|mt |db_';
	 elif [ \\\`uname\\\` = SunOS ]; then ps -ef   |  egrep 'python|ecmd|encp|reader|writer|dasadmin|mt |db_';
         fi"
    stat=$?
    ;;

  *)
    echo "Getting help lines, one moment please...."
    echo
    echo
    usage="
$usage1
ecmd encp `ecmd encp --usage_line`

ecmd cc `ecmd cc --usage_line`

ecmd fcc `ecmd fcc --usage_line`

ecmd vcc `ecmd vcc --usage_line`

ecmd lmc `ecmd lmc --usage_line`

ecmd mcc `ecmd mcc --usage_line`

ecmd mvc `ecmd mvc --usage_line`

ecmd lc `ecmd lc --usage_line`

ecmd ic `ecmd ic --usage_line`

ecmd ac `ecmd ac --usage_line`
$usage2
"
    echo "$usage"
    stat=$?
    if [ "$cmd" != "help" ]; then stat=1; fi;

esac

exit $stat

