#!/bin/sh

if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
set -u  # force better programming and ability to use check for not set

. $ENSTORE_DIR/bin/defaults

usage="
ecmd start   (no options/arguments)
ecmd stop    (no options/arguments)

ecmd encp    [--config_list --list --help ] inputfilename outputfilename
ecmd config  [--config_list --config_file=  --dict --load --list --help]
ecmd fcc     [--config_list --bfids --bfid= --list --help]
ecmd vcc     [--config_list --vols  --vol=  --list --help']

ecmd pnfs    [--test --status --file= --list --help]

ecmd rddt    [--size= --device= --eod_cookie= --list --help]

ecmd clbk    (no options/arguments)
ecmd udpc    [--msg= --host= --port= --list --help]
ecmd ranf    [--size= --file= --list= --help']
"

if [ -z "${1-}" ] ; then
  echo "$usage"; exit 1;
else
  cmd=$1
  shift
fi

stat=0

case $cmd in
  start|enstore-start)
    $ENSTORE_DIR/bin/enstore-start
    stat=$?
    ;;
  stop|enstore-stop)
    $ENSTORE_DIR/bin/enstore-stop
    stat=$?
    ;;

  encp)
    python $ENSTORE_DIR/src/encp.py                  --config_host $config_host --config_port=$config_port $@
    stat=$?
    ;;
  config|econ)
    python $ENSTORE_DIR/src/configuration_client.py  --config_host $config_host --config_port=$config_port $@
    stat=$?
    ;;
  fcc|bfid)
    python $ENSTORE_DIR/src/file_clerk_client.py     --config_host $config_host --config_port=$config_port $@
    stat=$?
    ;;
  vcc)
    python $ENSTORE_DIR/src/volume_clerk_client.py   --config_host $config_host --config_port=$config_port $@
    stat=$?
    ;;


  pnfs)
    python $ENSTORE_DIR/src/pnfs.py $@
    stat=$?
    ;;


  rddt)
    python $ENSTORE_DIR/src/driver.py $@
    stat=$?
    ;;
  clbk)
    python $ENSTORE_DIR/src/callback.py $@
    stat=$?
    ;;
  udpc)
    python $ENSTORE_DIR/src/udp_client.py $@
    stat=$?
    ;;
  ranf)
    python $ENSTORE_DIR/src/ranfile.py $@
    stat=$?
    ;;

  help)
    echo "$usage"
    stat=$?
    ;;
  *)
    echo "$usage"
    stat=1

esac

exit $stat

