#!/bin/sh
#set -u  # force better programming and ability to use check for not set
if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi

if [ -n "${1-}" ]; then opt=$1; else opt=""; fi

doit() { if [ -z "${1-}" ]; then echo "$cmd"; fi
         eval "$cmd"
       }

stopit() { cmd="ezapit -s 15 python        >/dev/null 2>&1"; doit quiet
           cmd="ezapit -s  9 db_checkpoint >/dev/null 2>&1"; doit quiet
           cmd="ezapit -s 15 db_deadlock   >/dev/null 2>&1"; doit quiet
           if [ "$opt" = "stop" ]; then exit 0; fi
         }

starttrc() { cmd="traceMode 7 >/dev/null"; doit quiet
             cmd="traceReset  >/dev/null"; doit quiet
           }

case `uname -n` in

   rip10*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/configuration_server.py  --config_file=/home/bakken/enstore/etc/rip.conf &"; doit
    cmd="python /home/bakken/enstore/src/log_server.py &"; doit
    cmd="python /home/bakken/enstore/src/alarm_server.py &"; doit
    cmd="python /home/bakken/enstore/src/media_changer.py adicr1.media_changer &"; doit
    (sleep 2;ecmd cc  --alive;                      if [ $? -ne 0 ]; then echo CONFIG DEAD;               else echo config alive;               fi) &
    (sleep 2;ecmd lc  --alive;                      if [ $? -ne 0 ]; then echo LOG DEAD;                  else echo log alive;                  fi) &
    (sleep 2;ecmd ac  --alive;                      if [ $? -ne 0 ]; then echo ALARM DEAD;                else echo alarm alive;                fi) &
    (sleep 2;ecmd mcc --alive adicr1.media_changer; if [ $? -ne 0 ]; then echo ADICR1.MEDIA_CHANGER DEAD; else echo adicr1.media_changer alive; fi) &
    ;;

   rip11*)
    stopit; starttrc
   #cmd="python /home/bakken/sam/src/mover.py DE13DLT.mover &"; doit
    cmd="python /home/bakken/sam/src/mover.py DM18AIT.mover &"; doit
    cmd="python /home/bakken/sam/src/mover.py DM19AIT.mover &"; doit
   #(sleep 2;ecmd mvc --alive DE13DLT.mover; if [ $? -ne 0 ]; then echo DE13DLT.MOVER DEAD; else echo de13dlt.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM18AIT.mover; if [ $? -ne 0 ]; then echo DM18AIT.MOVER DEAD; else echo dm18ait.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM19AIT.mover; if [ $? -ne 0 ]; then echo DM19AIT.MOVER DEAD; else echo dm19ait.mover alive; fi) &
    ;;

   rip12*)
    stopit; starttrc
   #cmd="python /home/bakken/sam/src/mover.py DE14DLT.mover &"; doit
    cmd="python /home/bakken/sam/src/mover.py DC15MAM.mover &"; doit
   #cmd="python /home/bakken/sam/src/mover.py DC16MAM.mover &"; doit
    cmd="python /home/bakken/sam/src/mover.py DC17MAM.mover &"; doit
   #(sleep 2;ecmd mvc --alive DE14DLT.mover; if [ $? -ne 0 ]; then echo DE14DLT.MOVER DEAD; else echo de14dlt.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DC15MAM.mover; if [ $? -ne 0 ]; then echo DC15MAM.MOVER DEAD; else echo dc15mam.mover alive; fi) &
   #(sleep 2;ecmd mvc --alive DC16MAM.mover; if [ $? -ne 0 ]; then echo DC16MAM.MOVER DEAD; else echo dc16mam.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DC17MAM.mover; if [ $? -ne 0 ]; then echo DC17MAM.MOVER DEAD; else echo dc17mam.mover alive; fi) &
    ;;

   rip6*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/volume_clerk.py &"; doit
    cmd="python /home/bakken/enstore/src/file_clerk.py &"; doit
    cmd="db_checkpoint -h /raid/enstore/db -p 5 &"; doit
    cmd="db_deadlock   -h /raid/enstore/db -t 1 &"; doit
    (sleep 2;ecmd vcc --alive; if [ $? -ne 0 ]; then echo VOLUME DEAD; else echo volume alive;fi) &
    (sleep 2;ecmd fcc --alive; if [ $? -ne 0 ]; then echo FILE DEAD;   else echo file alive;  fi) &
    ;;

   rip5*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/library_manager.py ait.library_manager &"; doit
    cmd="python /home/bakken/enstore/src/library_manager.py mam.library_manager &"; doit
    cmd="python /home/bakken/enstore/src/library_manager.py dlt.library_manager &"; doit
    (sleep 2;ecmd lmc --alive ait.library_manager; if [ $? -ne 0 ]; then echo AIT.LIBRARY_MANAGER DEAD; else echo ait.library_manager alive; fi) &
    (sleep 2;ecmd lmc --alive dlt.library_manager; if [ $? -ne 0 ]; then echo DLT.LIBRARY_MANAGER DEAD; else echo dlt.library_manager alive; fi) &
    (sleep 2;ecmd lmc --alive mam.library_manager; if [ $? -ne 0 ]; then echo MAM.LIBRARY_MANAGER DEAD; else echo mam.library_manager alive; fi) &
    ;;

   rip1*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/mover.py DC03MAM.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py DC04MAM.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py DC05MAM.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py DC06MAM.mover &"; doit
    (sleep 2;ecmd mvc --alive DC03MAM.mover; if [ $? -ne 0 ]; then echo DC03MAM.MOVER DEAD; else echo dc03mam.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DC04MAM.mover; if [ $? -ne 0 ]; then echo DC04MAM.MOVER DEAD; else echo dc04mam.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DC05MAM.mover; if [ $? -ne 0 ]; then echo DC05MAM.MOVER DEAD; else echo dc05mam.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DC06MAM.mover; if [ $? -ne 0 ]; then echo DC06MAM.MOVER DEAD; else echo dc06mam.mover alive; fi) &
    ;;

   rip2*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/mover.py DE01DLT.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py DE02DLT.mover &"; doit
    (sleep 2;ecmd mvc --alive DE01DLT.mover; if [ $? -ne 0 ]; then echo DE01DLT.MOVER DEAD; else echo de01dlt.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DE02DLT.mover; if [ $? -ne 0 ]; then echo DE02DLT.MOVER DEAD; else echo de02dlt.mover alive; fi) &
    ;;


   rip7*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/library_manager.py disk.library_manager &"; doit
    cmd="python /home/bakken/enstore/src/library_manager.py null.library_manager &"; doit
    cmd="python /home/bakken/enstore/src/media_changer.py disk.media_changer &"; doit
    cmd="python /home/bakken/enstore/src/mover.py disk1.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py disk2.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py null1.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py null2.mover &"; doit
    cmd="python /home/bakken/enstore/src/inquisitor.py &"; doit
    (sleep 2;ecmd lmc --alive disk.library_manager; if [ $? -ne 0 ]; then echo DISK.LIBRARY_MANAGER DEAD; else echo disk.library_manager alive; fi) &
    (sleep 2;ecmd lmc --alive null.library_manager; if [ $? -ne 0 ]; then echo NULL.LIBRARY_MANAGER DEAD; else echo null.library_manager alive; fi) &
    (sleep 2;ecmd mcc --alive disk.media_changer;   if [ $? -ne 0 ]; then echo DISK.MEDIA_CHANGER DEAD;   else echo disk.media_changer alive;   fi) &
    (sleep 2;ecmd mvc --alive disk1.mover;          if [ $? -ne 0 ]; then echo DISK1.MOVER DEAD;          else echo disk1.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive disk2.mover;          if [ $? -ne 0 ]; then echo DISK2.MOVER DEAD;          else echo disk2.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive null1.mover;          if [ $? -ne 0 ]; then echo NULL1.MOVER DEAD;          else echo null1.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive null2.mover;          if [ $? -ne 0 ]; then echo NULL2.MOVER DEAD;          else echo null2.mover alive;          fi) &
    (sleep 2;ecmd ic  --alive;                      if [ $? -ne 0 ]; then echo INQUISITOR DEAD;           else echo inquisitor alive;           fi) &
    ;;

   rip9*)
    stopit; starttrc
    cmd="python /home/bakken/enstore/src/media_changer.py STK.media_changer &"; doit
    cmd="python /home/bakken/enstore/src/library_manager.py red50.library_manager &"; doit
    cmd="python /home/bakken/enstore/src/library_manager.py red20.library_manager &"; doit
    cmd="python /home/bakken/enstore/src/mover.py stk1.mover &"; doit
    cmd="python /home/bakken/enstore/src/mover.py stk2.mover &"; doit
    (sleep 2;ecmd mcc --alive STK.media_changer;     if [ $? -ne 0 ]; then echo STK.MEDIA_CHANGER DEAD;     else echo stk.media_changer alive;      fi) &
    (sleep 2;ecmd lmc --alive red50.library_manager; if [ $? -ne 0 ]; then echo RED50.LIBRARY_MANAGER DEAD; else echo red50.library_manager alive;  fi) &
    (sleep 2;ecmd lmc --alive red20.library_manager; if [ $? -ne 0 ]; then echo RED20.LIBRARY_MANAGER DEAD; else echo red20.library_manager alive;  fi) &
    (sleep 2;ecmd mvc --alive stk1.mover;            if [ $? -ne 0 ]; then echo STK1.MOVER DEAD;            else echo stk1.mover alive;             fi) &
    (sleep 2;ecmd mvc --alive stk2.mover;            if [ $? -ne 0 ]; then echo STK2.MOVER DEAD;            else echo stk2.mover alive;             fi) &
    ;;

   fntt*)
    stopit; starttrc
    #cmd="python /export/home/bakken/enstore/src/mover.py DM05AIT.mover &"; doit
    #cmd="python /export/home/bakken/enstore/src/mover.py DM07AIT.mover &"; doit
    #(sleep 2;ecmd mvc --alive DM05AIT.mover; if [ $? -ne 0 ]; then echo DM05AIT.MOVER DEAD; else echo dm05ait.mover alive; fi) &
    #(sleep 2;ecmd mvc --alive DM07AIT.mover; if [ $? -ne 0 ]; then echo DM07AIT.MOVER DEAD; else echo dm07ait.mover alive; fi) &
    ;;

   ripsgi*)
    stopit; starttrc
    cmd="python /usr/people/bakken/enstore/src/mover.py DM07AIT.mover &"; doit
    cmd="python /usr/people/bakken/enstore/src/mover.py DM08AIT.mover &"; doit
    cmd="python /usr/people/bakken/enstore/src/mover.py DM09AIT.mover &"; doit
    cmd="python /usr/people/bakken/enstore/src/mover.py DM10AIT.mover &"; doit
    cmd="python /usr/people/bakken/enstore/src/mover.py DM11AIT.mover &"; doit
    cmd="python /usr/people/bakken/enstore/src/mover.py DM12AIT.mover &"; doit
    (sleep 2;ecmd mvc --alive DM07AIT.mover; if [ $? -ne 0 ]; then echo DM07AIT.MOVER DEAD; else echo dm07ait.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM08AIT.mover; if [ $? -ne 0 ]; then echo DM08AIT.MOVER DEAD; else echo dm08ait.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM09AIT.mover; if [ $? -ne 0 ]; then echo DM09AIT.MOVER DEAD; else echo dm09ait.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM10AIT.mover; if [ $? -ne 0 ]; then echo DM10AIT.MOVER DEAD; else echo dm10ait.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM11AIT.mover; if [ $? -ne 0 ]; then echo DM11AIT.MOVER DEAD; else echo dm11ait.mover alive; fi) &
    (sleep 2;ecmd mvc --alive DM12AIT.mover; if [ $? -ne 0 ]; then echo DM12AIT.MOVER DEAD; else echo dm12ait.mover alive; fi) &
    ;;

   samson*)
    stopit; starttrc
    cmd="python /fnal/ups/prd/enstore/x0_4/src/configuration_server.py  --config_file=/fnal/ups/prd/enstore/x0_4/etc/sam.conf &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/log_server.py &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/alarm_server.py &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/library_manager.py samdisk.library_manager &"; doit
   #cmd="python /fnal/ups/prd/enstore/x0_4/src/library_manager.py samnull.library_manager &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/media_changer.py samdisk.media_changer &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/mover.py samdisk1.mover &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/mover.py samdisk2.mover &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/mover.py samdisk3.mover &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/mover.py samdisk4.mover &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/mover.py samdisk5.mover &"; doit
   #cmd="python /fnal/ups/prd/enstore/x0_4/src/mover.py samnull1.mover &"; doit
    cmd="python /fnal/ups/prd/enstore/x0_4/src/inquisitor.py &"; doit
    (sleep 2;ecmd cc  --alive;                         if [ $? -ne 0 ]; then echo CONFIG DEAD;                  else echo config alive;                  fi) &
    (sleep 2;ecmd lc  --alive;                         if [ $? -ne 0 ]; then echo LOG DEAD;                     else echo log alive;                     fi) &
    (sleep 2;ecmd ac  --alive;                         if [ $? -ne 0 ]; then echo ALARM DEAD;                   else echo alarm alive;                   fi) &
    (sleep 2;ecmd lmc --alive samdisk.library_manager; if [ $? -ne 0 ]; then echo SAMDISK.LIBRARY_MANAGER DEAD; else echo samdisk.library_manager alive; fi) &
   #(sleep 2;ecmd lmc --alive samnull.library_manager; if [ $? -ne 0 ]; then echo SAMNULL.LIBRARY_MANAGER DEAD; else echo samnull.library_manager alive; fi) &
    (sleep 2;ecmd mcc --alive samdisk.media_changer;   if [ $? -ne 0 ]; then echo SAMDISK.MEDIA_CHANGER DEAD;   else echo samdisk.media_changer alive;   fi) &
    (sleep 2;ecmd mvc --alive samdisk1.mover;          if [ $? -ne 0 ]; then echo SAMDISK1.MOVER DEAD;          else echo samdisk1.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive samdisk2.mover;          if [ $? -ne 0 ]; then echo SAMDISK2.MOVER DEAD;          else echo samdisk2.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive samdisk3.mover;          if [ $? -ne 0 ]; then echo SAMDISK3.MOVER DEAD;          else echo samdisk3.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive samdisk4.mover;          if [ $? -ne 0 ]; then echo SAMDISK4.MOVER DEAD;          else echo samdisk4.mover alive;          fi) &
    (sleep 2;ecmd mvc --alive samdisk5.mover;          if [ $? -ne 0 ]; then echo SAMDISK5.MOVER DEAD;          else echo samdisk5.mover alive;          fi) &
   #(sleep 2;ecmd mvc --alive samnull1.mover;          if [ $? -ne 0 ]; then echo SAMNULL1.MOVER DEAD;          else echo samnull1.mover alive;          fi) &
    (sleep 2;ecmd ic  --alive;                         if [ $? -ne 0 ]; then echo INQUISITOR DEAD;              else echo inquisitor alive;              fi) &
    ;;

   rip3*)
    stopit; starttrc
    cmd="python /home/bakken/sam/src/volume_clerk.py &"; doit
    cmd="python /home/bakken/sam/src/file_clerk.py &"; doit
    cmd="python /home/bakken/sam/src/library_manager.py sammam.library_manager &"; doit
    cmd="python /home/bakken/sam/src/library_manager.py samait.library_manager &"; doit
    cmd="python /home/bakken/sam/src/library_manager.py samdlt.library_manager &"; doit
    cmd="python /home/bakken/sam/src/media_changer.py adicr2.media_changer &"; doit
    cmd="db_checkpoint -h /raid/enstore/db -p 5 &"; doit
    cmd="db_deadlock   -h /raid/enstore/db -t 1 &"; doit
    (sleep 2;ecmd vcc --alive;                        if [ $? -ne 0 ]; then echo VOLUME DEAD;                 else echo volume alive;                 fi) &
    (sleep 2;ecmd fcc --alive;                        if [ $? -ne 0 ]; then echo FILE DEAD;                   else echo file alive;                   fi) &
    (sleep 2;ecmd lmc --alive samait.library_manager; if [ $? -ne 0 ]; then echo SAMAIT.LIBRARY_MANAGER DEAD; else echo samait.library_manager alive; fi) &
    (sleep 2;ecmd lmc --alive samdlt.library_manager; if [ $? -ne 0 ]; then echo SAMDLT.LIBRARY_MANAGER DEAD; else echo samdlt.library_manager alive; fi) &
    (sleep 2;ecmd lmc --alive sammam.library_manager; if [ $? -ne 0 ]; then echo SAMMAM.LIBRARY_MANAGER DEAD; else echo sammam.library_manager alive; fi) &
    (sleep 2;ecmd mcc --alive adicr2.media_changer;   if [ $? -ne 0 ]; then echo ADICR2.MEDIA_CHANGER DEAD;   else echo adicr2.media_changer alive;   fi) &
    ;;

   *)
    ;;
esac
