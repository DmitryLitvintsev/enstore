#!/bin/sh
if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
set -u  # force better programming and ability to use check for not set

if [ -z "${1-}" ] ; then echo usage $0 pid-file; exit 1; fi

if [ ! -r $1 ] ; then exit; fi

#echo Stopping `basename $1 | sed -e 's/_pids$//'`

cat $1 | while read pid; do
    if [ `ps $pid 2>&1 | grep -c $pid` -ne 0 ]; then 
      kill $pid
      if [ `ps $pid 2>&1 | grep -c $pid` -ne 0 ]; then 
        echo "ERROR: Process $pid STILL LIVES" 
      fi
    fi
done

rm -f $1
