#!/bin/sh

if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
set -u  # force better programming and ability to use check for not set

. $ENSTORE_DIR/etc/defaults

# first shut down the databases
for pid in $enstore_db/`uname -n`-db_*_pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-db_*_pids" ] ; then echo "No databases running"; break; fi
    pidkill $pid
done

# next shut down the movers
for pid in $enstore_db/`uname -n`-mover*pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-mover*pids" ] ; then echo "No movers running"; break; fi
    pidkill $pid
done

# next shut down the media changers
for pid in $enstore_db/`uname -n`-media_changer*pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-media_changer*pids" ] ; then echo "No media changers running"; break; fi
    pidkill $pid
done

# next shut down the library manager
for pid in $enstore_db/`uname -n`-library_manager*pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-library_manager*pids" ] ; then echo "No library managers running"; break; fi
    pidkill $pid
done

# next shut down the file clerk
for pid in $enstore_db/`uname -n`-file_clerk*pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-file_clerk*pids" ] ; then echo "No file clerks running"; break; fi
    pidkill $pid
done

# next shut down the volume clerk
for pid in $enstore_db/`uname -n`-volume_clerk*pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-volume_clerk*pids" ] ; then echo "No volume clerks running"; break; fi
    pidkill $pid
done


echo "what else"
for pid in $enstore_db/`uname -n`-*_pids; do
    if [ "$pid" = "$enstore_db/`uname -n`-*_pids" ] ; then break; fi
    pidkill $pid
done
exit
