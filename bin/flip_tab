#!/bin/sh

output=/tmp/write_tab.output

work=/diska/write_protect_work
if [ ! -d $work ]; then
   echo `date` ERROR. $work does not exist
   exit 1
fi

for i in $work/*; do
  . $i >>$output 2>&1
  echo 
  echo
  echo "1. Open CAP door"
  echo "2. Remove all tapes from CAP"
  echo "3. Close CAP door"
  echo "4. Flip tabs to write-protect on all tapes"
  echo "5. Hit ENTER when you are finished"
  read ans
  /usr/bin/rsh fntt -l acsss "echo 'enter 0,0,0' |/export/home/ACSSS/bin/cmd_proc " >/dev/null 2>/dev/null
  echo "6. Open CAP door"
  echo "7. Insert tapes into CAP"
  echo "8. Close CAP door"
  echo "9. Hit ENTER when you are finished"
  echo 
  /bin/echo -n "Were all of these steps successful [y or n]? "
  read ans
  if [ $? -eq 0 ] &&  expr "$ans" : '[Yy]' >/dev/null ; then
     echo "... success acknowledged"
     rm -f $i >/dev/null 2>/dev/null
  else
     echo "... failure noted"
  fi
  echo
  echo
  /bin/echo -n "Another [yn]? "
  read ans
  if [ $? -eq 0 ] &&  expr "$ans" : '[Yy]' >/dev/null ; then
     x=1
  else
     break
  fi
done
