<MA-config Update="600" Name="AgentPingEnstore">
<ItemList Name="Enstore">
	<Item Name="STKEN"/>
	<Item Name="D0EN"/>
</ItemList>
<ServiceClass Name="Service">
        <ServiceType Name="0x0"/>>
        <ServiceType Name="24x7"/>
</ServiceClass>
   <NCS Heartbeat="1200" Port="19997" Host="ngop" Type="Daemon"/>
   <For Each="Item" In="ItemList" Name="Enstore" Var="{%C}">

   <System Name="Ping" Cluster="{%C}">
  <For Each="ServiceType" In="ServiceClass" Name="Service" Var="{%ST}" Filename="/var/ngop/include/fermi_hosts.xml" >
      <For Each="Host" In="Cluster" Name="{%C}{%ST}" Var="{%Host}" Filename="/var/ngop/include/fermi_hosts.xml" >
     <MonitoredElement Name="ping" Type="Hardware" Host="{%Host}">
         <ConditionSet>
            <fn Name="isUp" Arg="{%Host}" RetVal="int:x"/>
            <Condition State="0" SevLevel="2" Description="Host is unreachable">
               <apply>
                  <apply>
                     <eq/>
                     <ci>x</ci>
                     <cn>1</cn>
                  </apply>
               </apply>
	<Action ID="email" Host="ndem" Type="central" >
            <Exec Name="email" Argument="Address:ngop-admin@isd.fnal.gov,operator@fnal.gov,Subject:Ngop_Report,Message:%Host:{%ST}:%ID:%Description" />
        </Action>
            </Condition>
            <Condition State="1"  SevLevel="4" Description="Packets lost">
               <apply>
                  <apply>
                     <eq/>
                     <ci>x</ci>
                     <cn>2</cn>
                  </apply>
               </apply>
            </Condition>
            <Condition State="1" SevLevel="4" Description="ICMP Service is unavailable">
               <apply>
                  <apply>
                     <eq/>
                     <ci>x</ci>
                     <cn>3</cn>
                  </apply>
               </apply>
            </Condition>
            <Condition State="1" SevLevel="4" Description="Ping timed out">
               <apply>
                  <apply>
                     <eq/>
                     <ci>x</ci>
                     <cn>5</cn>
                  </apply>
               </apply>
            </Condition>
         </ConditionSet>
      </MonitoredElement>
	</For>
	</For>
   </System>
</For>
</MA-config>

