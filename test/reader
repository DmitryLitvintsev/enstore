#!/bin/sh
if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi

usage="USAGE: $0 base_read_dir_path"

if [ -n "${1-}" ] ; then
    base=$1
else
    echo "$usage"
    exit 1
fi

set -u  # force better programming and ability to use check for not set

rm -f read_list*
rm -f reader.out

read_list=./reader_list.$$

while /bin/true; do
    if [ -r $ENSTORE_DIR/test/readstop ] ; then exit 0; fi
    rm -fr $read_list
    find $base/ -type f -print >> $read_list
    cat $read_list | while read f; do
        if [ -r $ENSTORE_DIR/test/readstop ] ; then exit 0; fi
        rm -f reader.out
        ecmd encp $f reader.out
    done
done
