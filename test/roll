#!/bin/sh
if [ "${1:-}" = "-x" ] ; then set -xv; shift; fi
set -u  # force better programming and ability to use check for not set

rm -f longstop
rm -f readstop
rm -f writestop

writem=1
if [ "${1:-}" = "-nowrite" ] ; then
    shift
    writem=0
fi

readem=1
if [ "${1:-}" = "-noread" ] ; then
    shift
    readem=0
fi

if [ -z "${1-}" ] ; then
  echo "No output directory specified"
  exit 1
else
  place=$1
fi

if [ $writem -eq 1 ] ; then
   for d in 1 2 3; do
      (cd $d; echo starting writer in `pwd`; rm -f writer.output; ./writer /pnfs/enstore/$place ../data.in >writer.output 2>&1 &)
   done
fi

if [ $readem -eq 1 ] ; then
   for d in 1 2 3; do
      (cd $d; echo starting reader in `pwd`; rm -f reader.output; ./reader /pnfs/enstore/$place  >reader.output 2>&1 &)
   done
fi
