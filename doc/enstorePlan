Enstore Plan for Completion and Estimate to Implement

Evaluate current architecture and adapt where necessary

Determine what is missing (and iterate) for Run II deployment

Estimate time to complete software for Run II deployment

Hire outside consultant to review outline of plan (Ruth will coordinate)        DROPPED

Written report on system architecture

Written report on development plan and estimate to complete

Report to Run II Steering Committee
        There is no requirement to do any coding at all, but the more actual measurements, the better.
        Prepare Presentation to von Ruden Committee



Check of MSS requirements for enstore:

=============================================================================
NO CATEGORY YET

(9) Evaluation of tape drives and associated media is still                     Possibly extended media changer, driver
    ongoing. Therefore, the required tape cartridges (or cassettes), drives,
    and robotic libraries have not yet been determined. These components will
    be specified in a later version of the MSS requirements.

-+ 3 enstore uses ftt to access tapes including error counts and media capacity

(63) The MSS shall be scalable so as to provide the anticipated performance     OK
     required by the Fermilab Run II experiments.

-+ 0 enstore very scalable in data moving.  Bottle necks might occur databasesa/servers and robotic capacities.

=============================================================================
Data Migration (HSM)

(12) The MSS shall provide the capability to build storage hierarchies          New work
     containing a list of storage resource classes together with associated
     policies that shall be used to control data movement between those
     resources (e..g., a storage hierarchy containing disk at the top level of
     the hierarchy with tape at the second, lowest level; migration, purge and
     stage policies that control when file data is moved between levels and
     removed from the higher level)

-+ 3 major new work.   Enstore is seen as a backend to a disk cache.

=============================================================================
Retrieve and Specify Tape Contents

(2) Data files shall be located on tape in such a way as to optimize efficient  Experiment can specify format
    access to the files.

-+ 0 data is placed on tape in the order submitted considering prioirities and file familes

(10) The MSS shall allow data files to be placed on tape media in such a way    Experiment can specify format
     that the files can be efficiently accessed and retrieved from the storage
     system.

-+ 0 file famililies, different library managers allow control

(13) The MSS shall allow MSS clients to identify groups of files that are to    File families provide this
     be stored on a common set of physical tape volumes. The MSS shall
     guarantee that physical tape volumes only contain files identified to be
     part of the same grouping.

-+ 0 file famililies, different library managers allow control

(14) The MSS shall ensure that tape media is efficiently utilized. Files        Work: we need device level control of all drives
     should be appended to tapes in such a way that all the media is used and
     tape is written to physical end of media.

-+ 2 enstore currently marks tape full and starts a news tape when a file won't fit.
     volume clerk logic vailable in movers.   Problems ejecting tapes.

(15) Files shall span tapes (if necessary) in order to fill an allocated        Files spanning tapes is new work
     tape(physical volume) in a storage class before starting a new tape.

-+ duplicate of 14?

(16) Each tape physical volume shall only contain files belonging to a single   File families provide this
     file family.

-+ 0 

(17) There shall be up to 1000 (TBD) different file families.                   No limit

-+ 0 

(18) A user with appropriate authorization shall be able to create a new file   PNFS allows this
     family.

-+ 0 

(19) A file family shall belong to one or more user groups.                     PNFS allows this

-+ 0 

(21) A file family shall have the property of "width". The MSS shall, given     File families provide this
     sufficient physical resources, be able to concurrently mount the number
     of tapes equal to the width of the file family, and shall be able to
     write files to those tapes in parallel.

-+ 0 

(22) The width of a file family shall not exceed the number of physical + tape  New work
     drives in the storage system.

-+ 1

(23) The user or application shall be able to specify the family name or ID at  PNFS allow this
     the time the file is created.
-+ 
(26) It will be useful to have namespace objects that are mapped to physical    New work
     tape volumes.

-+ 2  

(31) Tools shall be available so that users can determine the mapping of files  New work
     to tapes.  These tools shall generate the following reports and lists:
     List of all files on a tape (or set of tapes) and location of files on
     the tape; Indication of whether file is internal or external to tape
     library. Oldest and Youngest file on a tape.

-+ 2

(38) Tools shall be available so as to identify tape volumes by file, file      New work
     family, creation/change dates of files, and date of last tape mount.
     These tools shall allow users to identify tapes that are candidates for
     removal from the tape library. Users shall be able to generate reports
     from MSS metadata, as follows: List all of the tapes belonging to a File
     Family and date of most recent mount of the tape. List all of the tapes
     within a File Family such that each file is older than a specified
     date.Location of a file (or set of files): tape identifier and whether
     internal or external to the tape library. List of tape volumes, sorted by
     date of the most recent mount of the tape. Indicate whether tape is
     internal or external to library.

-+ 2
 
(39) The report shall indicate MSS behavior when an access attempt is made of   New work
     a file on the tape: (1) request operator mount,or (2) return warning
     message to user.

-+ 2

(59) Users shall be able to use the report and list generation tools described  OK
     in Section 2.

-+ 2

(85) File Families An application or user shall be able to determine the        PNFS allows this
     family name and ID of a file through the FTP and API interfaces.

-+ 1

(86) A user can create reports on file, family, and volume information such     New work
     as: The family name, COS and volume of a file. All of the files in a file
     family, All of the tape volumes in a file family.

-+ 1
 
(87) A user shall be able to create a file family by using a utility program.e  PNFS allows this

-+ 1

=============================================================================
Eject to shelf

(3) Data files shall be located on tape in such a way as to allow tapes to be   Experiment can specify format
    removed from the robotic library and placed in a vault or distributed to
    another organization.

-+ 2 The whole ejection thing is 3 it becomes more difficult if files span volumes.

(32) The utilities for ejecting and returning tapes from/to the MSS tape        New work
     library (or libraries) shall be capable of automatically running in the
     background to the core MSS servers as a batch job, and shall not
     interfere with the normal operation of the MSS and tape robotic arm.

-+ 2

(33) Ejected tapes could also remain in the tape library, but be assigned to    Volume clerk allows this
     another storage software.

-+ 2
 
(34) It shall be possible for a user (member of the group(s) that own tape      OK
     volumes) to specify a list of volumes that the robotic library will eject
     from the library.

-+ 2

(35) When selecting a tape to be ejected, a user shall be able to specify the   New work
     type of behavior that is to occur if a file on the tape is subsequently
     requested for access. The user shall be able to specify one of the two
     types of behavior: When a file access is attempted (open for read or
     write), a message is displayed to the MSS operator that requests that the
     affected tape be retrieved from the vault and mounted in a tape drive or
     placed back into the library.The file access fails, and an appropriate
     error message is returned to the user indicating that the file is not
     currently available
-+ 2
(36) If a file spans tape volumes and at least one of the volumes has been      Spanning is new work
     ejected from the library, the MSS shall exhibit one of the behaviors
     described above.  That behavior shall be the same as if ALL the volumes
     on which the file resides were ejected from the library.
-+ 2
(37) It shall be possible for the user to change the file access behavior of    New work
     an ejected tape after the tape has been removed from the tape library.  A
     tool and user interface shall be available to allow the user to change
     that part of the MSS metadata that controls the policy of attempting to
     read a file from an ejected tape.
-+ 2
(40) An MSS utility program shall allow tapes to be marked for ejection.        New work
-+ 2
(41) The utility shall also interact with the robot to cause the tapes to be    New work
     ejected and will mark the MSS file/tape metadata to show that the tapes
     are not in the robotic library.
-+ 2
(42) This utility shall run in the background to the MSS core servers, and      New work
     shall not interfere with the normal operation of the MSS.
-+ 2
(43) The utility shall take the following options:Maximum number of tape        New work
     volumes to eject.
-+ 2
(44) When tapes are ejected from the MSS library, an associated set of          New work
     intermediate metadata shall also (optionally) be exported as a flat file.
-+ 2
(45) This metadata file shall provide tape file information such that a         New work
     utility program could read the files and copy them to a standard Unix
     file system.
-+ 2
(46) The tape eject utility shall have the option to leave the tape in the      New work
     library so that it is available to another software application that
     could read the MSS tape.
-+ 2
(47) The MSS shall be able to exchange (total of eject/export and               Enstore not involved
     re-insert/import) up to 200 tapes per day through the robot(s) I/O tray.
-+ 2
(48) There shall be two scenarios whereby volumes are re-inserted into the      New work
     tape library.  Tape is manually inserted by the operator in response to a
     open read/write request.Batches of tapes can be re-inserted into the
     robotic tape library by stacking the cartridge (or cassettes) into the
     robot I/O tray




=============================================================================
Read Only

(27) It shall be possible to optionally mark a tape volume as "Read Only". The  Volume clerk provides this
     Read Only status of a tape shall be maintained in the MSS metadata.
-+  0
(28) Tapes shall be marked as ReadOnly under the one of the following           New work
     conditions: All of the files on the tape are older than a specified
     period of time.
-+ 2
(29) Tools shall be available so that tapes can be marked and unmarked as Read  Volume clerk provides this
     Only.
-+ 0
(30) If a user or application attempts to open for writing a file that is       Volume clerk provide this
     marked as "Read Only", a suitable error message shall be returned to the
     user by the MSS interface program.
-+ 0
(53) Tapes that have been ejected (but not exported) for the purpose of         Volume clerk provides this
     reading outside of the MSS should be physically marked as "Read Only"
     because the MSS metadata still accounts for these tapes and it is assumed
     that they be eventually placed back into the MSS library.
-+ 1

=============================================================================
Import

-+ assuming imported tapes are read-only the import module is an easy 3 

(55) A utility shall be provided that can write files to tapes and can create   New work
     a set of intermediate metadata, such that the tapes and metadata can be
     imported into the Fermilab MSS.
-+ 
(56) This utility shall be executable external to the MSS, on other             New work
     processor(s), at other sites or institutions.
-+ 
(57) A utility shall be provided that will allow tapes(and associated           New work
     metadata) to be imported into the MSS.
-+ 
(58) An export utility will be provided that will allow tapes to be exported    New work
     from the MSS.


=============================================================================
Open Format
-+ ? It is relatively easy to add "file wrappers" in enstore.  Each style wrapper is a 2

(49) An "open" tape and metadata format shall be provided such that software    OK, but more formats probably needed
     (external of the MSS software and infrastructure) can read files from
     ejected tapes, and can write files to tapes that will be imported into
     the Fermilab MSS.
-+ 
(50) The open formats shall allow other programs, utilities, and other mass     OK
     storage systems to read and write tapes that are compatible with the
     Fermilab MSS.
-+ 
(51) A utility shall be provided that can read files from tapes that have been  OK
     ejected or exported from the MSS robotic tape library system.
-+ 
(52) This utility program shall be able to run outside of and independent of    OK
     the MSS servers and infrastructure, and would make use of a set of
     metadata associated with the tapes.
-+ 
(54) All tapes written by the Fermilab MSS shall be in the native format (for   OK
     example, in HPSS format).
-+ 
=============================================================================
Resource Management
-+ resource optimization is difficult to design w/o know network and tape characteristics

(1) The storage equipment will be shared by the experiment groups and the MSS   Dynamic movers provide this
    shall provide a priority system so that each group has access to its quota
    of resources.
-+ 
(4) Tape drives will be in short supply, and thus tape drive activity shall be  Dynamic movers provide this
    optimized.
-+ 
(5) The number of tape mounts shall be minimized for typical file access        Library manager provides this
    patterns.
-+ 
(7) Robotic tape libraries (especially the robot arm and storage slots) will    Library manager provides this
    be in short supply, and their use shall be optimized.
-+ 
(11) The MSS shall provide the capability to configure storage resources        Dynamic movers provide this
     (drives and media) into different groupings, such that files requiring
     different storage or administrative characteristics (e.g., high-volume
     date rates, low latency to access data, group X's tape volumes) can be
     directed to an appropriate set of storage resources.
-+ 
(24) The MSS shall provide the capability for files to be written directly to   Movers provide this
     a tape media. The MSS shall also provide the capability for files that
     were initially written directly to tape to either be read directly from
     tape or first staged to disk before being read (to perform speed matching
     and/or file buffering).  It shall be possible to assign ownership of a
     COS to a user group.
-+ 
(25) It shall also be possible to configure the MSS such that a COS will have   Dynamic movers provide this
     ownership of storage resources (tape volumes)and devices (tape drives).
     Read Only Access for Groups of Tapes (and Files).
-+ 
(60) Access and Interface Methods. The Fermilab MSS shall provide an            Attached drives - new work
     application programming interface (API) so that client software programs
     can access the storage system servers.

-+ 3 A lot of design work is needed.  It is important that client software 
     allows queueing with prioirities and retries and that client users can
     determine the status of files so local resources can be managed.   Must address 
     Multiple copies of critical files.

(61) This API shall execute on the client processor, shall provide C++          New work: C++ interface
     language interfaces, and shall not require MSS infrastructure software
     (DCE, Encina, SFS, SAMMI) on the client processor.
-+ 
(62) The client API shall be available in source and binary for the following   New work - not all platforms ready
     OS platforms: SGI IRIX, IBM AIX, Digital Unix, Intel Linux, Windows NT,
     Sun Solaris.
-+ 
(64) For some categories of data, files must be copied to tape as soon as       Dynamic movers allow this
     possible. Therefore, it must be possible to allocate a minimum number of
     tape drives to the process of writing the privileged categories of files
     to tape.
-+ 
(65) When possible, the MSS shall optimize the use of multiple robotic          Library manager provides this
     libraries and arms so as to maximize the capacity of the system to
     perform tape cartridge movement. It shall be possible to queue up
     requests to move tape volumes.
-+ 
(66) The MSS software shall have the capability to limit file system requests   Library manager provides this
     such that the available resources will not be exhausted.
-+ 
(67) When a request is made to read or write a file to the MSS, the system      New work
     shall return an estimated time to complete the request.

-+ 2  This is easy in the library manager which keeps the work queues and
      knows the size of files

(68) The MSS shall allow the establishment of quotas for storage resources.     New work
     These limits shall be established for a single user, user group, and file
     family.

-+ this needs design work.  It seems like it could be done statically on a 
     daily basis.  Every quota system needs a recalculate procdure anyway

(69) Quotas shall include: Number of objects in the namespace (files,           New work
     filesets, directories, etc.
-+ 
(70) The gatekeeper function shall filter requests to the MSS and throttle      Library manager provides this
     use.  The gatekeeper shall provide the capability for user level
     scheduling of storage requests.

-+ needs design work. The library manager can do this but it needs info
     from databases

(71) All user access methods(NFS, FTP, client API, DFS) shall go through the    Library manager and PNFS allows this
     gatekeeper, which shall provide the following system throttling
     functions: Temporarily suspend access to the MSS in order to allow
     maintenance activities and/or implementation of additional resources
     (such as mover nodes, tape drives, etc.)
-+ 
(84) The process of loading, labeling, and allocating the blank tape volumes    New work?
     shall be done in the background to the core MSS software and shall not
     interfere with the other MSS operations.

-+ This will be substantial load on resources.  Entering 50 new tapes, mounting/
   dismounting/formatting at 1 min per tape is ?/day
=============================================================================
Availability
-+ 
(6) There will be unattended operations for at least eight hours per day,       Goal, unproven as of now
    seven days per week.

-+ 3 This will require trapping all potential errors and testing all error paths
   meaning you need to simulate the error. 

(8) Recording to tape of raw experiment data shall continue for several weeks   OK
    (up to a month) at a time. This data recording shall be uninterrupted by
    lower priority file I/O activity or system management tasks (such as
    metadata backups, software upgrades, etc.)
-+ 
(73) The MSS shall be able to support 30 days of continuous data file           Goal, unproven as of now
     acquisition and accumulation to tapes in the robotic tape libraries. The
     30 day (minimum) time interval shall not be interrupted by maintenance
     activities or system outages (defined as unable to continue to record
     data files).
-+ 
(82) Data Acquisition. The MSS shall be able to receive files of raw            Goal, dictated by hardware
     experiment data at the peak sustained rate of 35 MB/sec. The data
     acquisition rate of 35 MB/ sec (3 TB per day) shall be sustained for a
     period of 30(TBD) days.

-+ Setting up the last test bed took three weeks

(83) The MSS shall be able to receive a total of 5 TB of data per day,          Goal, dictated by hardware
     equivalent to 100 tapes. The MSS shall be able to add 700 blank tape
     volumes per week.
-+ 
(95) The MSS system shall also provide the capability to issue alarms under     New work
     the following conditions: The MSS system falls below a TBD threshold
     capacity or performance.  Certain TBD critical work cannot be completed.
-+ 
=============================================================================
Fault Tolerance
-+ 
(72) The failure of a single component shall not cause the system to become     Library manager provides
     unavailable for the high priority data movement tasks.
-+ 
(74) The system shall have a fail-over capability such that if a component      New work - automated fail over
     fails, file access services shall continue at reduced capacity.
-+ 
(75) In case a failure or error condition occurs with a fail-over component, a  Library manager provides
     message shall be logged to a report file, but file services shall
     continue without operator intervention.
-+ 
(76) When a read/write error occurs with a tape drive, the system shall retry   more work in FTT
     TBD times and shall log error counts.

-+ 2 drivers and modern tape drives do retry and errorsare logged by the movers.
     The work is maintaing the error history in the volume and drive databases
     and s determining policies.

(77) If the tape drive still generates errors after the maximum number of       new work
     retries, the MSS shall take the tape drive off-line and retry the file or
     tape operation (such as stage, migrate, or repack) with another tape
     drive.
-+ 
(78) Processor nodes that are used for data movement (to/from MSS clients and   New work - automation
     between storage hierarchies) and to control storage devices (tape drives
     and disks) shall have the capability to be automatically taken off-line
     without bringing down other MSS services.
-+ 
(79) When a data movement processor fails, file access services shall continue  Library manager provides
     at reduced capacity,a message shall be logged to a report file, and file
     services shall continue without operator intervention.
-+ 
(80) It shall be possible to bring the repaired processor back on-line without  Dynamic mover allows
     disruption to the other MSS services.
-+ 
(81) When a disk drive fails, the MSS shall take it off line and mark the       New work
     drive down.
-+ enstore has no disk cache.  The problem is pushed the clients.  When a client
   disk is lost and data is queued from it, the data is lost.

(97) File Transfer Errors To/From MSSClient - Determine if error is due to      More work to make robust
     network, client processor machine,corrupted file, etc.
-+ 
=============================================================================
Administration and Monitoring
-+ 
(20) A graphical user interface (GUI) shall be available to give users the      New work
     ability to list, add, and manage files in file families.

-+ 2  a command line interface is just as important so users can build systems
     systems around it.  The gui is easy with TK if needed.

(88) Trash Basket - When files are deleted, they shall go into a trash basket.  New work

-+ 3 if this means comapcting tapes   Enstore is designed as a permanent repository

(89) There shall be a TBD limit to the number of files that can exist in the    New work
     trash basket for a user or group.
-+ 
(90) All administrative and system management functions shall be accessible     New work
     through a GUI and through Unix shell commands (such as Korn shell).

-+ DB maintenance and one time work will be an ongoing task

(91) Unless otherwise noted, these functions shall operate in the background    OK
     to the MSS servers, and shall not interfere with the normal operation of
     the Fermilab MSS. The complete list of functions is TBD.
-+ 
(92) The MSS system monitor shall provide GUI displays of health and status of  New work
     all components in the system.

-+ 2  most of this work is deciding what and what not to display and getting
      consensus from users.

(93) When error or failure conditions occur, the system monitor shall provide   New work
     visual notification through GUI status indicators.

-+ 2 this must meld with data center operations.  Learning to interface with them
     is part of the task.

(94) Some critical messages shall also automatically be sent to operators by    New work
     e-mail.

-+ 1 the logger is modulerized

(96) The MSS Health and Status system shall have a command line (CLI)           New work
     capability such that a shell script (or software product) can receive the
     alarms and repair the alarm condition.
-+ 
(98) Number of read/write error for each disk drive.                            More work - ftt
-+ 2 This info is all available - the work is in reporting it 

(99) Tape drive use                                                             New work
-+ 
(100) Number of read/write errors for each tape drive.                          New work
-+ 
=============================================================================
Items not in requirements that need to get finished:

is it time to switch to C?

general code cleanup - standards?
        uniform ticket

better tracing, logging capabilities

wrappering framework

attachable debugger

i/o rate demonstration

test stand

database backups + pnfs

user interface, user status

retry logic, broken tcp connections

volume list, file family list

user documentation, internal documentation

fmss interface

ftt - more drive supported

read different tape formats, including hpss

regression tests
