<h1>Interfaces and Integration</h1>

<h2>Interfaces</h2>

<h3>Intrinsic Interfaces</h3>

Below is an (incomplete) summary of interfaces that are intrinsic to
the Enstore software. They are more or begin specified and coded as
part of the software project.

<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=0>

<TH> <P><FONT COLOR="#0000ff"><FONT SIZE=2><B>Function</B></FONT></FONT></TH>
<TH> <P><FONT COLOR="#0000ff"><FONT SIZE=2><B>Person</B></FONT></FONT></TH>
<TH> <P><FONT COLOR="#0000ff"><FONT SIZE=2><B>Software</B></FONT></FONT></TH>


<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Initiate a specific transfer betwen tape and disk</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Experimenter</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>ENCP</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Organize names</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Experimenter</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>PNFS</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Choose library to write to</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Experimenter</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>PNFS</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Create file families, administer width</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Experimenter</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>PNFS</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Instantaneous Status on Web</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administrator</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Inquisitor</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Summary status on Web</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administrator</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Inquisitor</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Routine periodic monitoring</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>TBD</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Patrol  (or TBD?) + Alarm module</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Summary status on Web</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administrator</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Inquisitor</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Move volumes between shelf and library</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Experimenter</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administration Utility</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Move volumes between shelf and out-of-system (includes
new volumes)</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Experimenter</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administration Utility</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Drain System</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administrator </B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administration Utility</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Shutdown System</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administrator</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administration Utility</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>(Re)Start System</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administrator</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore Administration Utility</B> </FONT> </TD>


</TABLE>


<h3> Enstore System Instance Interface</h3>

<p> Interfacing to an experiment means placing Enstore in a larger
system context. 

<p> From the point of view of Enstore with network attached tapes, there is an
Enstore system which interfaces to the rest of D0 on at the NIC-card cable
connector. In addition to the interfaces to the user and administrators (which
are intrinsic to Enstore software), there are other miscellaneous interface
issues associated with a real instance of the software, since the whole system
must conform to the Experiments, Division's and Laboratories system
constraints:

<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=0>

<TH> <P><FONT COLOR="#0000ff"><FONT SIZE=2><B>Type</B></FONT></FONT></TH>
<TH> <P><FONT COLOR="#0000ff"><FONT SIZE=2><B>Constraint</B></FONT></FONT></TH>
<TH> <P><FONT COLOR="#0000ff"><FONT SIZE=2><B>Imposed by</B></FONT></FONT></TH>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Network</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Conforming Physical Media</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Network</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Protocol Extensions</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Network</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>8K minimum UDP Datagram size</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Enstore</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Network</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Traffic pattern to machines where one NIC card is not sufficient,</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Siting</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Location</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Operations</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Run II Operations Software Framework (Patrol or TBD)</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Operations</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Failure planning (i.e. broken tape library, Power)</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Operations</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Upgrade-ability</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Operations + Security</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Standard Administration</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>

<TR VALIGN=TOP>
<TD> <P><FONT SIZE=2><B>Security</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>Authentication etc are TBD</B> </FONT> </TD>
<TD> <P><FONT SIZE=2><B>System</B> </FONT> </TD>




</TABLE>


<h2>Integration for D0.</h2>



<h3> Salient entities for D0</h3>

<p>All production hardware is to come from the D0 Budget, requisitioned by
D0. This includes the Enstore system, tape drives and other peripherals.</p>

<p>D0 have a baseline system design. From the point of view of the storage
management project, The main features the D0 system are:    </p>

<ul>
 <li>IP Based connectivity.

 <li>A few SMP boxes back-ending their D.A. at the D0 assembly building.

 <li>An analysis facility in FCC consisting of a large SMP box and
 smaller SMP boxes.

 <li>Many hundred farm nodes, most likely an ensemble of small P.C.'s or
 economical RISC work stations provided by the lowest bidder.  Whether there
 are "I/O nodes" associated with the farm is  TBD.

 <li>An Enstore system with about 8-10 mover nodes.
</ul>

<h3>Network system design and integration issues</h3>

<p> Given the discussion above, the main interface issues with D0 are:

<ul>
 <li> Specification  and design of a data Lan
 <li> The number and type of NIC cards on each computer.
 <li> Tuning the features in Enstore for the significant multiple NIC card
      machines.
</ul>


<p> To keep transfers efficient, It is important to have a network design
which avoids congestion.  

<p> It is important to characterize the rate achievable on a NIC card, and the
amount of CPU required to drive NIC cards.  Typically, there is less CPU/BYTE
when writing to the network, then when read from it. One vendor reports, fro
CPU's available in late 1998:

<pre>
	10-11 MB/sec on a 100mbps ethernet NIC
	30-35 MB/sec on a Gbit ethernet card (standard MTU)
	70-80 MB/sec on a Gbit ethernet card (jumbo MTU)
	
	30-35 MB/sec/CPU   standard ethernet frames
	78    MB/sec/CPU   "jumbo" (~9000 byte) frames.
					(n.b. GB ethernet here...)
</pre>

<p>On an analysis server, Allocation of streams to NIC cards is most easily
accomplished statistically. For machines with very many potential streams,
this is best effected by fewer, fatter pipes.  Ideally, there is little packet
loss and traffic is regulated by the TCP window.  If Jumbo frames were
acceptable not generally, but only between the Enstore system and the D0
analysis machine, statistical load balancing over four GB NICs consuming two
CPUS could be could easily sustain the (imagined) 150 MB/sec peak tape rate
for D0, with very little congestion.

<p>The problem becomes more difficult as the throughput of a NIC card
decreases. The basic unit of transfer is a stream carrying the full tape
rate.  (i.e 5MB/sec for AIT-2 + some allowance for expansion).  It is in fact,
a little questionable whether two such tape streams should be multiplexed onto
a single 100MBPS nic card -- Congestion, slow start and other rate-inhibiting
mechanisms may be invoked.



<h3>Other system design and integration issues</h3>

<ul>
<li> A specific site for the Enstore installation has not been identified.
<li> The Enstore project has begun to learn about PATROL, but is unaware of
     its formal selection for Run II.
<li> The OSS dept has work items relating to installing and administering the
     operating systems for the D0 Enstore system.
<li> Run II authentication systems are TBD.
<li> The Enstore mover machines have not yet been identified.
</ul>




