<html> <head>

<title> Items to check </title>

</head>

<body BGCOLOR=#FFFFFF>

<font size=7><b><i>
<center>Items to Watch to Make Sure Enstore Runs Smoothly</center>
</i></b></font>
<br><p>

<br><p>
<center>$Revision$</center>
<center>$Date$GMT</center>
<br><p>

<br><p>

Enstore was written to monitor itself and take appropriate action
whenever it can.  Sometimes this is not possible.  Keeping an eye on
the following items allows an administrator to be proactive and ensure
that the system keeps running efficiently.

<ul>

<li> The <a
href="http://www-d0en.fnal.gov/enstore/enstore_alarms.html">Alarm
Page</a> generated by the Alarm server lists items that need immediate
administrator attention.  After the alarm has been resolved, you can
clear it by using the web page.  Although the page is automatically
updated, you can also hit the "reload" button to get the current
status.  <a
href="http://www-d0en.fnal.gov/enstore/enstore_alarm_search.html"> Old
Alarms </a> can also be reviewed or searched.

<p>
<li> Another good page to watch is the <a
href="http://www-d0en.fnal.gov:/patrol/patrol.html"> Patrol Page </a>.
It provides a status page, having the same information as the alarm
page, that will be centrally monitored. You might have to wait (at
most) 15 minutes for the Patrol cronjob to update the Patrol
informationa and you might have to hit the "update" button on the top
of the page to get the current status. One thing to remember, you have
to hit "back" in your browser quite a few times to got back to your
previous page since the patrol page has lots of frames.

<p>
<li> If you are interested in details, the <a
href="http://www-d0en.fnal.gov/enstore/status_enstore_system.html">
Status Page </a> provides a thorough listing of all the various parts
of Enstore.

  <ul>
   <li> The inquisitor generates this page every few minutes and the
   page should automatically update (depending on your browser) for
   you as well.  Please remember that the information may not be
   current, but might represent the state up to 5 minutes ago.  Also,
   since the various Enstore components are queried at different
   times, on rare occasions it could look like there is contradictory
   information (mover says it is writing a tape but the library
   manager says the mover is idle); the situation should resolve
   itself with the next write of the web page.

   <li> One item that is easy to spot is when servers are
   highlighted. That means the inquisitor has not been able to
   communicate with them, which usually implies that something has
   happened and the server has either crashed or hung.  These
   situations are becoming more and more infrequent.  If you see
   highlighted servers, don't be too quick to try and restart things -
   the inquisitor probably has already sent the appropriate commands
   to do that. One needs to understand more of what is happening
   before taking action.

</ul>

<p>
<li> The most detailed source of what is going on in the system is the
<a href="http://www-d0en.fnal.gov/enstore/enstore_logs.html"> Log
Pages </a>.  It requires some effort to read and understand.<p> <li>
One nice feature about the web interface is that you can <a
href="http://www-d0en.fnal.gov/enstore/enstore_log_file_search.html">
search </a> a subset of log files.

 <ul>

  <li> You need to keep hitting "reload" to get the most current
  information if you read the log though the web interface.

  <li> If there is a problem, it may be easier to log into d0ensrv2
  and look at the log directly.  You can find it in
  /diska/enstore-log.

 </ul>


<p>
<li> You can get a good idea of how the system is performing by
watching the <a
href="http://www-d0en.fnal.gov/enstore/encp_enstore_system.html"> Encp
History/Transfer Page </a>.  Generally there should be activity all
the time.  Remember that mammoth-1 drives have a maximum rate of 3
MB/S, DLT-7000 drives have a maximum rate of 5 MB/S, and the maximum
throughput of a single Fast Ethernet connection is 11 MB/S.

<p>
<li> Enstore runs quite a few cronjobs. You can check their status on
the <a href="http://www-d0en.fnal.gov/enstore/cron_pics.html"> Cronjob
Status Page.</a>. The plots are updated once an hour.

 <ul>

  <li> Each graph shows exit status on the y axis and job time on the
  x axis. The graph goes back 1 week in time.  The date on the right
  most part of the graph should be tomorrow's date. If it's not, you
  are looking at old graphs.  The graphs are remade once per hour (via
  a cronjob, of course.) The graphs will be titled with the node name
  and the name of the cronjob.

  <li> Each time a cron job is started, an "x" is made on the graph at
  10. Look for a "regular" pattern. Investigate unusual empty places
  on the graphs.

  <li> When a cronjob finishes, an "x" is made on the graph with its
  exit status. The only correct status is 0. Investigate all non-zero
  values.
 </ul>



<p>
<li> It is a good idea to check the volumes defined to the system.
There's currently no web page for this.
 <ul>

  <li> Log into one of the console servers, d0ensrv3 or d0ensrv5,

  <li> Type "setup enstore"

  <li> Type "enstore volume --vols"

  <li> Look especially for volumes marked "NOACCESS" and try to
  determine why they are in that state.  Don't just clear them!
 </ul>


<p>
<li> You can look at the monthly performance of the system by looking
at the <a href="http://www-d0en.fnal.gov/enstore/enplot_xfer.log.ps">
Activity Plot, </a> <a
href="http://www-d0en.fnal.gov/enstore/enplot_bpd.ps"> Bytes/Day Plot
</a>, <a href="http://www-d0en.fnal.gov/enstore/enplot_mlat.ps"> Mount
Latency Plot, </a> and the <a
href="http://www-d0en.fnal.gov/enstore/enplot_mph.ps"> Mounts/Hr
Plots.</a> These plots are updated once per day by the inquisitor (or
they can be generated on demand).

<p>
<li> A recent snapshot of the tape drives in the AML/2 robot is
available on the <a
href="http://www-d0en.fnal.gov/enstore/aml2_drive_status.txt"> AML/2
Drive Status Page</a> (within the miscellaneous status page). The page
is updated every 10 minutes.

 <ul>

  <li> You can also query the AML/2 drive status directly by logging
  onto one of the d0en server nodes, preferably one of the console
  server nodes, d0ensrv3 or d0ensrv5, and issuing the command
  "dasadmin listd2".

  <li> DECDLT drives DE01-DE02, Mammoth-1 drives DC03-DC06 and AIT-1
  drives DM07-DM12 should have their state "st: UP" and be assigned to
  "client: rip5".  These drives are used for Enstore testing.

  <li> DECDLT drives DE13-DE14, Mammoth-1 drives DC15-DC17, DC20-DC29
  and AIT-1 drives DM18-DM19 should have their state "st: UP" and be
  assigned to "client: d0ensrv4".  These drives are used for D0
  production.

  <li> The "clean_count" indicates how many times a tape has been
  mounted in the drive.  For your information, the way you tell how
  many times a tape has been mounted, is by using the command
  "dasadmin view -t [8MM|DECDLT] tape_label.

  <li> "volser: label" indicates which tape is currently mounted, if
  any, in the tape drive.

 </ul>
<p>
<li> You can see the state of the PCs by looking at the <a
href="http://www-d0en.fnal.gov/enstore/enstore_node_uptimes.txt">Enstore
Node Uptime Page </a> (within the miscellaneous status page). The page
is updated every 10 minutes.

 <ul>

  <li> You can also query the PC state directly by logging onto one of
  the d0en server nodes, preferably one of the console server nodes,
  d0ensrv3 or d0ensrv5, and issuing the command "rgang -n d0en
  /usr/local/bin/uptime"

  <li> The first item listed is the nodename.  Movers should be listed
  twice since there are 2 ethernet ports. [Both respond with the "a"
  mover name.]

  <li> Next is an item "bogo" which lists the bogomips for each
  processor on the node.  Since all nodes, except the console servers,
  have dual 450 MHz, you should see 2 bogo values around 450.  If
  there is just 1, that means only 1 processor is active.  The 2
  console servers have dual 400 MHz so they should have 2 values both
  around 400.

  <li> Next is "memf/mtot" which is the ratio of memory free to memory
  total.  All nodes have 512 MB of memory (which is reduced to 505
  somehow?)

  <li> Next you'll see the current time.  All the nodes are ntp
  synced, so they should all have the correct time.  Earilier nodes
  may show a minute earlier than the later ones since the information
  is currently gathered serially for all the nodes.

  <li> Next you'll see the uptime.  Generally the nodes should be up
  for a long time.  Look for nodes that seemed to have booted recently
  and find out why.

  <li> Next is number of users.  Typically, only the console servers
  should have users on them. Find out who is using the nodes and why.

  <li> Next is the load average.  There are 3 numbers showing what the
  average has been during the last minute, 5 minutes and 15 minutes.
  High numbers, anything about 3 are probably bad.

   <li> Finally is listed the kernel version and when it was compiled.
   They should all be alike, except for the console servers.
 </ul>

<p>
<li> You can also see the PC temperatures, voltages and fan speeds by
checking the <a href="http://www-d0en.fnal.gov:/enstore/SDR.html"> SDR
Page </a> (located within the Enstore Log File Page).

<p>
<li> You can check the <a
href="http://www-d0en.fnal.gov/enstore/d0ensrv1_raid_status.txt"> Raid Status
Page </a> (within the miscellaneous status page) to look for errors.  This page is updated every few
minutes. You can also log into d0ensrv1 and type "raidinfo" to get
current values.  One needs to pay particular attention to the 1st few
lines that show the disk's current state.

<p>
<li> Information about the network is available at <a
href="http://airedale.fnal.gov/biga.html"> BigA Switch Page </a>
(within the Enstore Log File Page).  Remember that all nodes have full
duplex Fast Ethernet lines - there should not be any errors,
collisions, jabbers at all.  <a
href="http://heidrum.fnal.gov/MRTG/dzero/s-d0-fcc2w.html"> MRTG Rate
</a> plots for the nodes are also available from the BigA Switch
Page..

<p>
<li> If there are AML/2 problems, you can check the <a
href="http://www-d0en.fnal.gov:/enstore/aml2log.html"> AML/2 Log </a>
(within the Enstore Log File Page) for errors.  These pages are
updated every 15 minutes. The information is detailed and takes some
time to understand completely.  An attempt to <a
href="http://www-d0en.fnal.gov:/enstore/aml2rpt.html"> summarize </a>
the information is also available. The summary filters out most
extraneous information for you, but is still not perfect.  Direct
access to the AML/2 logs is possible either by looking at the OS/2
adic2 node in front of the robot, or by logging into adic2 as enstore,
cd'ing to 'cd \das\bin', and running the log 'amulog' (you quit by
typing 'q' and 'exit').


</ul>


</BODY>
</HTML>
