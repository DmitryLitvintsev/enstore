#! /usr/bin/env python
 
# etc/$RCSfile$  $Revision$

KB=1024
MB=KB*KB
GB=KB*MB

ait1_rate = 2.7 * MB
mam1_rate = 2.8 * MB
dlt_rate = 5.1 * MB
eagle_rate = 10.5 * MB
ait2_rate = 9.5 * MB
mam2_rate = 11.5 * MB

mvr_max_consecutive_failures=3
mvr_max_failures=5
mvr_check_f = 30
vol_max_noaccess_cnt=4

configdict = {}

configdict['priority'] = {'happynull.library_manager':{'adminpri':{10:{'host':'rip6+',
                                                                       'work':'write_to_hsm',

                                                                       },
                                                                   }
                                                       }
                          }
configdict['known_config_servers'] = {'d0en'  : ('d0ensrv2.fnal.gov',7500),
                                      'stken' : ('stkensrv2.fnal.gov',7500),
                                      'rip'   : ('rip7.fnal.gov',7500), }

configdict['system'] = { 'allowed_down' : {'log_server' : [1,10],
                                           'alarm_server' : [1,10],
                                           'configuration_server' : [1,10],
                                           'file_clerk' : [1,10],
                                           'inquisitor' : [3,30],
                                           'volume_clerk' : [1,10],
                                           'library_manager' : [2,20],
                                           'media_changer' : [2,10],
                                           'default' : [1,20] }}

configdict['blocksizes'] = { 'null'      : 131072,
                             '8MM'       : 131072,
                             'DECDLT'    : 131072 }

configdict['quotas'] = {'enabled':'yes',
                        'libraries':{'null1': {'EnsV1':   1,
                                               'null':    100,
                                               },
                                     'cdf':   {
                                               'cdf':         1111,
                                              },
                                     'eagle': {'auger':        100,
                                               'btev':          10,
                                               'backups':      102,
                                               'ckm':           10,
                                               'cms':          663,
                                               'd0lib-archive': 75,
                                               'e831':         230,
                                               'eagle':          9,
                                               'EnsV1':         36,
                                               'minos':         70,
                                               'null':          23,
                                               'sdss':         257,
                                               'selex':        210,
                                               'test':          11,
                                               'theory':       200,
                                               'E872':           4,
                                               'e791':          30,
                                               'e835':          10,
                                               },
                                     'eval-a': {'test':50,},
                                     'eval-b': {'test':50,},
                                     'test':  {'test':10,
                                               },
                                     'disk':  {'T1': 100,
                                               },
                                     '9940': {'test':          100,
                                              'backups':        50,
                                              'cdf':            85,
                                              'D0':            535,
                                              'e740':           50,
                                              'btev':          100,
                                              'E815':           10,
                                              'theory':         50,
                                              'ktev':          164,
                                              'cms':           442,
                                              'patriot':        20,
                                              'e871':           80,
                                              'e907':          100,
                                              'miniboone':      15,
                                              'cdf-sam':        85,
						},
                                     },
                        #'order' effects the order of the inventory
                        # VOLUME_QUOTAS page..
                        'order':{'top':[(None, 'auger'),
                                        (None, 'btev'),
                                        (None, 'cdf'),
                                        (None, 'ckm'),
                                        (None, 'cms'),
                                        (None, 'D0'),
                                        (None, 'd0lib-archive'),
                                        (None, 'e740'),
                                        (None, 'e791'),
                                        (None, 'e831'),
                                        (None, 'e835'),
                                        (None, 'E815'),
                                        (None, 'e871'),
                                        (None, 'E872'),
                                        (None, 'e907'),
                                        (None, 'ktev'),
                                        (None, 'miniboone'),
                                        (None, 'minos'),
                                        (None, 'patriot'),
                                        (None, 'sdss'),
                                        (None, 'selex'),
                                        (None, 'theory'),],
                                 'bottom':[('null1', None),]}
                        }

configdict['wrappersizes'] = { 'null': (2L*GB) - 1,
                               'cpio_odc'  : (8L*GB) - 1 }

configdict['database']     = { 'db_dir':'/home/huangch/db', 'jou_dir':'/home/huangch/jou' }

# too many name server failures - use the numeric ip - 131.225.164.8 is rip8
configdict['backup']       = { 'host':'rip1', 'dir':'/rip1a/enstore/db_backup'}

configdict['event_relay']   = { 'host':'rip7', 'port':55510 }
configdict['file_clerk']   = { 'host':'rip4',  'port':7501, 'logname':'FILSRV', 'norestart':'INQ' }
configdict['volume_clerk'] = { 'host':'rip4',  'port':7502, 'logname':'VOLSRV', 'norestart':'INQ' }
configdict['alarm_server'] = { 'host':'rip7',  'port':7503 ,'logname':'ALMSRV', 'norestart':'INQ' }
configdict['log_server']   = { 'host':'rip7',  'port':7504, 'log_file_path':'/fnal/ups/prd/www_pages/enstore/log', 'norestart':'INQ' }

configdict['inquisitor']   = { 'host':'rip7', 'port':7505, 'logname':'INQSRV',
                               'alive_rcv_timeout': 5, 'alive_retries':1,
                               'html_file':'/fnal/ups/prd/www_pages/enstore/',
                               'http_log_file_path':'/enstore/log/',
                               'www_host':'http://rip7.fnal.gov',
                               'default_alive_interval': 15 }

configdict['ratekeeper']   = {
    'host'    :'rip7',                       #node ratekeeper is running on
    'port'    :1718,                         #port ratekeeper is running on
    'event_relay_host':'rip7.fnal.gov',      #node event relay is running on
    'logname' :'RATSRV',                     #logname
    'dir'     :'/fnal/ups/prd/www_pages/enstore/rates',
    'tmp'     :'/tmp',                       #temp directory used
    'nodes'   :{},
    'ps'      :'/fnal/ups/prd/www_pages/enstore/*rates.ps',
    'jpg'     :'/fnal/ups/prd/www_pages/enstore/*rates.jpg',
    'stamp'   :'/fnal/ups/prd/www_pages/enstore/*rates_stamp.jpg'}


configdict['www_server'] = { 'system_tag' : "RIP Test of New Mover/Library Manager",
			     'media' : {'1': 'ADIC AML/2'},
                             'inq_ignore' : 1 }

configdict['accounting'] = {
    'host': 'rip1',
    'port': 7580,
    'dbhost': 'rip1.fnal.gov',
    'dbname': 'enstore'}

#configdict['ait.library_manager']   = { 'host':'rip5',  'port':7514, 'logname':'AITLBM', 'database':'/tmp/enstore/enstore/ait',  'norestart':'INQ' }

#configdict['mam.library_manager']    = {    'host':'rip5',
#                                            'port':7515,
#                                            'logname':'MAMLBM',
#                                            'database':'/tmp/enstore/enstore/mam',
#                                            'norestart':'INQ' }

configdict['monitor']   = {
    'html_dir'        : '/home/zalokar/label_files/',
    'html_gen_host'    : 'water',
    'refresh'          : 3600,
    'veto_nodes'       : {'d0ensrv8': 'not in system my reason'},
    'block_size'       : 65536,
    'block_count'      : 160,
    'default_timeout'  : 3 }

### configdict['dlt.library_manager']    = {    'host':'rip5',
###                                             'port':7516,
###                                             'logname':'DLTLBM',
###                                             'database':'/tmp/enstore/enstore/dlt',
###                                             'norestart':'INQ' }


#configdict['m2.library_manager']    = { 'host':'rip5',
#                                        'port':7512,
#                                        'logname':'M2LBM',
#                                        'norestart':'INQ',
#                                        'database': '/tmp/enstore/lm_db'}

configdict['null.library_manager']    = { 'host':'rip5',
                                        'port':7513,
                                        'logname':'NULLBM',
                                        'norestart':'INQ',
                                        'database': '/tmp/enstore/lm_db'}


#configdict['a2.library_manager']    = { 'host':'rip5',
#                                        'port':7514,
#                                        'logname':'A2LBM',
#                                        'database':'/tmp/enstore/enstore/mam',
#                                        'norestart':'INQ' }

#configdict['aml2r1.media_changer']   = { 'host':'rip5',
#                                         'port':7523,
#                                         'logname':'AML2R1',
#                                         'type':'AML2_MediaLoader',
#                                         'norestart':'INQ',
#                                         'RobotArm':'R1',
#                                         'IdleTimeHome':30000000,
#                                         'IOBoxMedia':{'ACI_8MM':['E02','E03','E04'],'ACI_DECDLT':['E01']},
#					 'DriveCleanTime':{'DE':[60,1],'DC':[60,1],'DM':[60,1]},
#                                         'CleanTapeFileFamily':'CleanTapeFileFamily.noWrapper'}

#configdict['m2_manual.media_changer'] = { 'host':'rip5', 
#                                          'port':7538,   
#                                          'type':'Manual_MediaLoader',
#                                          'logname':'M2_M_MC'}

configdict['null.media_changer'] = { 'host':'rip5',
                                     'port':7524,
                                     'logname':'NULMC',
                                     'type':'RDD_MediaLoader',
                                     'norestart':'INQ'}

### configdict['nullI1.mover']  =  { 'host':'ripsgi',
###                                  'data_ip':'ripsgi',
###                                  'port':7538,
###                                  'logname':'NUI1MV', 'norestart':'INQ',
###                                  'library':'null.library_manager',
###                                  'device':'/dev/null',
###                                  'driver':'NullDriver',
###                                  'media_changer':'null.media_changer'}

### configdict['nullI2.mover']  =  { 'host':'ripsgi',
###                                  'data_ip':'ripsgi',
###                                  'port':7539,
###                                  'logname':'NUI2MV',
###                                  'norestart':'INQ',
###                                  'library':'null.library_manager',
###                                  'device':'/dev/null',
###                                  'driver':'NullDriver',
###                                  'media_changer':'null.media_changer'}

### configdict['nullI3.mover']  =  { 'host':'ripsgi',
###                                  'data_ip':'ripsgi',
###                                  'port':7540,
###                                  'logname':'NUI3MV',
###                                  'norestart':'INQ',
###                                  'library':'null.library_manager',
###                                  'device':'/dev/null',
###                                  'driver':'NullDriver',
###                                  'media_changer':'null.media_changer'}

### configdict['nullI4.mover']  =  { 'host':'ripsgi',
###                                  'data_ip':'ripsgi',
###                                  'port':7541,
###                                  'logname':'NUI4MV',
###                                  'norestart':'INQ',
###                                  'library':'null.library_manager',
###                                  'device':'/dev/null',
###                                  'driver':'NullDriver',
###                                  'media_changer':'null.media_changer'}

###configdict['null05a.mover']  =  { 'host':'rip5',
###                                  #'data_ip':'d0enmvr17a',
###                                  'port':7542,
###                                  'logname':'NU05aMV',
###                                  'norestart':'INQ',
###                                  'library':'null.library_manager',
###                                  'device':'/dev/null',
###                                  'driver':'NullDriver',
###                                  'media_changer':'null.media_changer'}

###configdict['null05b.mover']  =  { 'host':'rip5',
###                                  #'data_ip':'d0enmvr17b',
###                                  'port':7543,
###                                  'logname':'NU05bMV',
###                                  'norestart':'INQ',
###                                  'library':'null.library_manager',
###                                  'device':'/dev/null',
###                                  'driver':'NullDriver',
###                                  'media_changer':'null.media_changer'}

#
# for ODS test
#

###configdict['nullods.library_manager']    = { 'host':'rip5',
###                                        'port':7517,
###                                        'logname':'NULODSLBM',
###                                        'norestart':'INQ',
###                                        'database': '/tmp/enstore/lm_db'}

configdict['null2a.mover']  =  { 'host':'rip2',
                                  'port':7547,
                                  'logname':'NULL2AMV',
                                  'norestart':'INQ',
                                  'library':'null.library_manager',
                                  'device':'/dev/null',
                                  'driver':'NullDriver',
                                  'media_changer':'null.media_changer'}
configdict['null2b.mover']  =  { 'host':'rip2',
                                  'port':7548,
                                  'logname':'NULL2BMV',
                                  'norestart':'INQ',
                                  'library':'null.library_manager',
                                  'device':'/dev/null',
                                  'driver':'NullDriver',
                                  'media_changer':'null.media_changer'}

#configdict['null3a.mover']  =  { 'host':'rip3',
#                                  'port':7548,
#                                  'logname':'NULL3AMV',
#                                  'norestart':'INQ',
#                                  'library':'nullods.library_manager',
#                                  'device':'/dev/null',
#                                  'driver':'NullDriver',
#                                  'media_changer':'null.media_changer'}

configdict['null4a.mover']  =  { 'host':'rip4',
                                  'port':7549,
                                  'logname':'NULL4AMV',
                                  'norestart':'INQ',
                                  'library':'null.library_manager',
                                  'device':'/dev/null',
                                  'driver':'NullDriver',
                                  'media_changer':'null.media_changer'}
configdict['null4b.mover']  =  { 'host':'rip4',
                                  'port':7550,
                                  'logname':'NULL4BMV',
                                  'norestart':'INQ',
                                  'library':'null.library_manager',
                                  'device':'/dev/null',
                                  'driver':'NullDriver',
                                  'media_changer':'null.media_changer'}

configdict['test4.mover'] = {	'host': 'rip4',
				'data_ip':'rip4',
				'port': 7569,
				'logname': 'TEST4MV',
				'max_consecutive_failures': mvr_max_consecutive_failures,
				'max_failures': mvr_max_failures,
				'check_written_file': mvr_check_f,
				'max_buffer' : 200*MB,
				'max_rate': mam2_rate,
				'mount_delay':30,
				'library': ['m2.library_manager'],
				'device' : '/dev/rmt/tps3d0n',
				'driver' : 'FTTDriver',
				'mc_device':'DI36',
				'media_changer':'m2_manual.media_changer',
				'norestart':'INQ' }

### configdict['DE01DLT.mover']  = { 'host':'rip2',
###                                  'data_ip':'rip2',
###                                  'port':7560,
###                                  'logname':'DE01MV',
###                                  'norestart':'INQ',
###                                  'library':['dlt.library_manager'],
###                                  'device':'/dev/rmt/tps3d1n',
###                                  'driver':'FTTDriver',
###                                  'max_buffer': 32*MB,
###                                  'mc_device':'DE01',
###                                  'media_changer':'aml2r1.media_changer'}


### configdict['DE02DLT.mover']  = {'host':'rip2',
###                                 'data_ip':'rip2',
###                                 'port':7561,
###                                 'logname':'DE02MV',
###                                 'norestart':'INQ',
###                                 'library':['dlt.library_manager'],
###                                 'device':'/dev/rmt/tps3d2n',
###                                 'max_buffer': 32*MB,
###                                 'driver':'FTTDriver',
###                                 'mc_device':'DE02',
###                                 'media_changer':'aml2r1.media_changer'}

"""
From cgw@fnal.gov Thu Jul  6 22:34:19 2000
Date: Thu, 06 Jul 2000 16:09:51 -0500 (CDT)
From: Charles G Waldman <cgw@fnal.gov>
To: bakken@fnal.gov
Subject: V2 mover configuration


These are all the keys that the mover cares about:

host (string) REQUIRED

port (int) REQUIRED

logname (string) OPTIONAL - defaults to mover name

do_eject (string) OPTIONAL - defaults to 'yes', override by setting
                    "no" or "No" (or anything starting with N or n)

mc_device (string) not needed for NULL movers; required otherwise

media_type (string) OPTIONAL - defaults to "8MM"  (see note ***)

min_buffer (int)  OPTIONAL minimum amount of memory to allocate for
                      buffering - defaults to 8MB

max_buffer (int)  OPTIONAL maximum amount of memory to allocate for
		      buffering - defaults to 64MB

max_rate (float) OPTIONAL maximum sustained transfer rate for writes
            This is used to calculate optimal buffer size.  It does not need to
            be exact.
                      
device (string) REQUIRED pathname to the UNIX tape device
			 for NULL movers make this /dev/null

dismount_delay (int) OPTIONAL delayed dismount value to use when none 
		     specified by the client.  Also, the client cannot
		     reduce this amount - they can ask for longer
		     dismount delay, but this value is a minimum.
		     Defaults to 60 seconds.
		     Set to negative value to get "infinite" dismount
		     delay.
mount_delay (int) OPTIONAL number of seconds to wait after media
		  changer mount completes, before trying to open
		  device. Default is 15 for FTT driver, 0 for NULL
		  driver

library (string or list):  REQUIRED.  Who are we working for?  One or
		  more library manager names.

driver (string): REQUIRED.  Currently must be 'FTTDriver' or
		 'NullDriver', or else mover will complain at startup.
		 If we need a disk mover, this would be easy to hack 
		 together; doesn't seem too useful though.

Notes:

***	   This is a bit of a hack.  When the mover starts up with a
volume, the delayed dismount timer gets started; if the timer expires
before any transaction comes in, the mover tries to dismount the
tape.  However it hasn't talked to the volume clerk and therefore
doesn't have the full vol_info ticket.  I can't just go query the
volume because I don't have a volume clerk address - this comes in on
an ENCP ticket.  I could go to my configuration and get the volume
clerk address from there, but we didn't want to do this - the mover
could possibly, for example, talk to different VC's if it's talking to
different LM's.  In order to dismount the volume, I need at least the
label and the media type.  If I don't have a media type, I get it from
the mover config.  Like I said, this is a hack.  I think the right fix
is to have the media changer client not require media type in the work
ticket - it should be able to dismount the volume without this info
(?)

"""

