#!/usr/bin/env python

# $Id$

KB=1024L
MB=KB*KB
GB=KB*MB

ait1_rate =   2.7 * MB
mam1_rate =   2.8 * MB
dlt_rate =    5.1 * MB
s9840_rate = 10.5 * MB
s9940_rate = 10.5 * MB
lto_rate =   15.0 * MB
ait2_rate =   9.5 * MB
mam2_rate =  11.5 * MB
null_rate =  11.5 * MB

mvr_max_consecutive_failures=3

mvr_max_failures=5

mvr_check_f = 30

vol_max_noaccess_cnt=4

configdict = {}

configdict['known_config_servers'] = {'d0en'  : ('d0ensrv2.fnal.gov',7500),
                                      'cdfen' : ('cdfensrv2.fnal.gov',7500),
                                      'stken' : ('stkensrv2.fnal.gov',7500),
                                      'rip'   : ('rip7.fnal.gov',7500), }

configdict['system'] = { 'allowed_down' : {'log_server' :           [1,10],
                                           'alarm_server' :         [1,10],
                                           'configuration_server' : [1,10],
                                           'file_clerk' :           [1,10],
                                           'inquisitor' :           [3,30],
                                           'volume_clerk' :         [1,10],
                                           'library_manager' :      [2,20],
                                           'media_changer' :        [2,10],
                                           'default' :              [1,20] }}

#configdict['priority'] = {'9940.library_manager':{'adminpri':{2:{'host': 'd0olc+'
#                                                                }
#                                                             }
#                                                  }
#                          }

configdict['quotas'] = {'enabled' : 'no', }

configdict['blocksizes'] = { '8MM'       : 131072,
                             'DECDLT'    : 131072,
                             'null'      : 131072,
                             '9840'      : 131072,
                             '9940'      : 131072 }

configdict['database']     = { 'db_dir':'/diskb/enstore-database', 'jou_dir':'/diska/enstore-journal' }

configdict['inventory']    = { 'inventory_dir'        : '/diskc/db-inventory',
                               'inventory_tmp_dir'    : '/diskc/db-inventory/tmp',
                               'inventory_cache_dir'  : '/diskc/db-inventory_cache',
                               'inventory_extract_dir': '/diskc/db-inventory/extract',
                               'inventory_rcp_dir'    : 'cdfensrv2:/fnal/ups/prd/www_pages/enstore/tape_inventory',
                               'authorized_file'      : '/home/enstore/enstore/etc/auth_stk.conf' }

configdict['ratekeeper']   = {
    'host'    :'cdfensrv2',                  #node ratekeeper is running on
    'port'    :55511,                        #port ratekeeper is running on
    'event_relay_host':'cdfensrv2.fnal.gov', #node event relay is running on
    'logname' :'RATSRV',                     #logname
    'dir'     :'/diska/ratekeeper/',         #directory to write rates to
    'tmp'     :'/diska/ratekeeper/tmp/',     #temp directory used
    'nodes'   :{},
    'ps'      :'/local/ups/prd/www_pages/enstore/*rates.ps',
    'jpg'     :'/local/ups/prd/www_pages/enstore/*rates.jpg',
    'stamp'   :'/local/ups/prd/www_pages/enstore/*rates_stamp.jpg'}

# too many name server failures - use the numeric ip -  131.225.215.5 is cdfensrv3
configdict['backup']       = { 'host':'131.225.215.5', 'dir':'/diska/enstore-backup', 'extract_dir':'/diska/check-db-tmp' }

configdict['event_relay']   = { 'host':'cdfensrv2', 'port':55510 }
configdict['file_clerk']   =  { 'host':'cdfensrv0', 'port':7501, 'logname':'FILSRV' ,'norestart':'INQ', 'brand':'B0MS', }
configdict['volume_clerk'] = { 'host':'cdfensrv0', 'port':7502, 'logname':'VOLSRV', 'norestart':'INQ', 
                               'norestart':'INQ', 'max_noaccess_cnt' : vol_max_noaccess_cnt }
configdict['alarm_server'] = { 'host':'cdfensrv2', 'port':7503 ,'logname':'ALMSRV', 'norestart':'INQ', }
configdict['log_server']   =  { 'host':'cdfensrv2', 'port':7504, 
				'log_file_path':'/diska/enstore-log', 
				'msg_type_logs': {'MSG_TYPE=MC_LOAD_REQ' : 'MOUNTS-',
						 'MSG_TYPE=MC_LOAD_DONE' : 'MOUNTS-',
						 'MSG_TYPE=ENCP_XFER' : 'ENCPS-',
						 'MSG_TYPE=EVENT_RELAY' : 'EVRLY-',
						 'MSG_TYPE=ADD_TO_LMQ' : 'LMQADDS-'},
				'norestart':'INQ', }

configdict['inquisitor']   = { 'host':'cdfensrv2', 'port':7505, 'logname':'INQSRV',
                               'alive_rcv_timeout': 5, 'alive_retries':1,
                               'refresh'          : 3600,
                               'html_file':'/local/ups/prd/www_pages/enstore/',
                               'http_log_file_path':'/enstore/log/',
                               'www_host':'http://cdfensrv2.fnal.gov:',
                               'max_encp_lines': 250,
                               'user_log_dirs' : {'Cdfen Cluster SDR Info'         :'/enstore/SDR.html',
                                                  'Cdfen Cluster SEL Info'         :'/enstore/SEL.html',
                                                  'Cdfen Cluster Console Logs'     :'/enstore/CONSOLES.html',
                                                  'Cdfen Internode Rates'          :'/enstore/quickcheck.eepro100.html',
						  'Cdfen Cluster UDP Clogup Info'  :'/enstore//UDPclog.html',
                                                  'Active Monitor Log'             :'/enstore/active_monitor.html',
                                                  'PNFS Counters'                  :'/enstore/pnfsRate.html',
                                                  'PNFS Export List'               :'/enstore/pnfsExports.html',
						  'Enstore Node Information'       :'/enstore/nodeinfo.html',
                                                  ' FAILED  Transfers'             :'/enstore/log/transfer_failed.txt ',
                                                  ' Recent STK log messages'       :'/enstore/log/STK-log.html ',},
			       'default_hung_interval' : 120,
                               'default_alive_interval': 30 }

configdict['monitor']   = {
    'html_dir'        : '/local/ups/prd/www_pages/enstore/',
    'html_gen_host'    : 'cdfensrv2',
    'refresh'          : 3600,
    'veto_nodes'       : {'rip3': 'not in system my reason'},
    'block_size'       : 65536,
    'block_count'      : 160,
    'default_timeout'  : 3 }

configdict['www_server'] = { 'system_tag' : "CDFEN: Enstore for the StorageTek Silo",
			     'media' : {'1' : 'STK Powderhorn 9310'},
                             'inq_ignore' : 1 }

configdict['null.library_manager']     =  { 'host':'cdfensrv4',  'port':7511, 'logname':'NULLBM', 'max_encp_retries':3,
                                             'norestart':'INQ','noupdown':'jon', 'inq_ignore':'jon',
                                             'suspect_volume_expiration_time':2,}
configdict['cdf.library_manager']     =  { 'host':'cdfensrv4',  'port':7515, 'logname':'CDFLM',
                                             'max_encp_retries':3,
                                             'min_file_size':300*MB, 'norestart':'INQ',
                                             'suspect_volume_expiration_time':3600*24,
                                             'legal_encp_version':'v2_15',
                                             }

configdict['test.library_manager']     =  { 'host':'cdfensrv4',  'port':7516, 'logname':'TSTLM',
                                             'max_encp_retries':3,
                                             'min_file_size':300*MB, 'norestart':'INQ',
                                             'suspect_volume_expiration_time':3600*24,
                                             'legal_encp_version':'v2_15',
                                             'noupdown':'jon',
                                             'inq_ignore':'efb' ,
                                             }


configdict['null.media_changer']     = { 'host':'cdfensrv4',  'port':7520, 'logname':'NULLMC',  'type':'RDD_MediaLoader',
                                         'norestart':'INQ','noupdown':'jon', 'inq_ignore':'jon' ,}

configdict['stk.media_changer']   =  { 'host':'cdfensrv4',  'port':7524,
                                       'logname':'STKMC ',
                                       'type':'STK_MediaLoader',
                                       'norestart':'INQ',
                                       'acls_host':'fntt2',
                                       'acls_uname':'acsss' }


### 'noupdown':'jon', 'inq_ignore' : 'jon',

configdict['null3.mover'] = { 'host':'cdfensrv3',
                              'data_ip':'cdfensrv3',
                              'port':7537,
                              'logname':'NUL3MV',
                              'norestart':'INQ',
                              'noupdown':'efb', 'inq_ignore' : 'jon',
                              'max_buffer':50*MB,
                              'library':'null.library_manager',
                              'device':'/dev/null',
                              'driver':'NullDriver',
                              'mc_device':'-1',
                              'media_changer':'null.media_changer',
                              }

configdict['99401.mover'] =  { 'host':'cdfenmvr1a',
                               'data_ip':'cdfenmvr1a',
                               'port':7601,
                               'logname':'BE1MV',
                               'statistics_path': '/tmp/enstore/enstore/BE1MV.stat',
                               'norestart':'INQ',
                               #'noupdown':'jon', 'inq_ignore' : 'jon',
                               'max_consecutive_failures': mvr_max_consecutive_failures,
                               'max_failures': mvr_max_failures,
                               'compression':0,
                               'check_written_file': mvr_check_f,
                               'max_buffer':350*MB,
                               'max_rate': s9940_rate,
                               'mount_delay':15,
                               'update_interval':5,
                               'library':'cdf.library_manager',
                               'device':'/dev/rmt/tps2d1n',
                               'driver':'FTTDriver',
                               'mc_device':'0,0,10,0',
                               'media_changer':'stk.media_changer',
                               'do_cleaning':'No'}
 

configdict['99402.mover'] =  { 'host':'cdfenmvr2a',
                               'data_ip':'cdfenmvr2a',
                               'port':7602,
                               'logname':'BE2MV',
                               'statistics_path': '/tmp/enstore/enstore/BE2MV.stat',
                               'norestart':'INQ',
                               #'noupdown':'jon', 'inq_ignore' : 'jon',
                               'max_consecutive_failures': mvr_max_consecutive_failures,
                               'max_failures': mvr_max_failures,
                               'compression':0,
                               'check_written_file': mvr_check_f,
                               'max_buffer':350*MB,
                               'max_rate': s9940_rate,
                               'mount_delay':15,
                               'update_interval':5,
                               'library':'cdf.library_manager',
                               'device':'/dev/rmt/tps2d1n',
                               'driver':'FTTDriver',
                               'mc_device':'0,0,10,1',
                               'media_changer':'stk.media_changer',
                               'do_cleaning':'No'}

configdict['99403.mover'] =  { 'host':'cdfenmvr3a',
                                'data_ip':'cdfenmvr3a',
                                'logname':'BE3MV',
                                'port':7603,
                                'statistics_path': '/tmp/enstore/enstore/BE3MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,2',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['99404.mover'] =  { 'host':'cdfenmvr4a',
                                'data_ip':'cdfenmvr4a',
                                'logname':'BE4MV',
                                'port':7604,
                                'statistics_path': '/tmp/enstore/enstore/BE4MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,3',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['99405.mover'] =  { 'host':'cdfenmvr5a',
                                'data_ip':'cdfenmvr5a',
                                'logname':'BE5MV',
                                'port':7605,
                                'statistics_path': '/tmp/enstore/enstore/BE5MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,4',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['99406.mover'] =  { 'host':'cdfenmvr6a',
                                'data_ip':'cdfenmvr6a',
                                'logname':'BE6MV',
                                'port':7606,
                                'statistics_path': '/tmp/enstore/enstore/BE6MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'test.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,5',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['99407.mover'] =  { 'host':'cdfenmvr7a',
                                'data_ip':'cdfenmvr7a',
                                'logname':'BE7MV',
                                'port':7607,
                                'statistics_path': '/tmp/enstore/enstore/BE7MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,6',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['99408.mover'] =  { 'host':'cdfenmvr8a',
                                'data_ip':'cdfenmvr8a',
                                'logname':'BE8MV',
                                'port':7608,
                                'statistics_path': '/tmp/enstore/enstore/BE8MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,7',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['99409.mover'] =  { 'host':'cdfenmvr9a',
                                'data_ip':'cdfenmvr9a',
                                'logname':'BE9MV',
                                'port':7609,
                                'statistics_path': '/tmp/enstore/enstore/BE9MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,8',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

configdict['994010.mover'] = { 'host':'cdfenmvr10a',
                                'data_ip':'cdfenmvr10a',
                                'logname':'BE10MV',
                                'port':7610,
                                'statistics_path': '/tmp/enstore/enstore/BE10MV.stat',
                                'norestart':'INQ',
                                #'noupdown':'jon', 'inq_ignore' : 'jon',
                                'max_consecutive_failures': mvr_max_consecutive_failures,
                                'max_failures': mvr_max_failures,
                                'compression':0,
                                'check_written_file': mvr_check_f,
                                'max_buffer':350*MB,
                                'max_rate': s9940_rate,
                                'mount_delay':15,
                                'update_interval':5,
                                'library':'cdf.library_manager',
                                'device':'/dev/rmt/tps2d1n',
                                'driver':'FTTDriver',
                                'mc_device':'0,0,10,9',
                                'media_changer':'stk.media_changer',
                                'do_cleaning':'No'}

"""
From cgw@fnal.gov Thu Jul  6 22:34:19 2000
Date: Thu, 06 Jul 2000 16:09:51 -0500 (CDT)
From: Charles G Waldman <cgw@fnal.gov>
To: bakken@fnal.gov
Subject: V2 mover configuration


These are all the keys that the mover cares about:

host (string) REQUIRED

port (int) REQUIRED

logname (string) OPTIONAL - defaults to mover name

do_eject (string) OPTIONAL - defaults to 'yes', override by setting
                    "no" or "No" (or anything starting with N or n)

do_cleaning (string) OPTIONAL - defaults to 'yes', override by setting
                    "no" or "No" (or anything starting with N or n)
                    This only controls automatic cleaning.  enstore mov --clean-drive
                    will always work, whether this is set or not.

mc_device (string) not needed for NULL movers; required otherwise

min_buffer (int)  OPTIONAL minimum amount of memory to allocate for
                      buffering - defaults to 8MB

max_buffer (int)  OPTIONAL maximum amount of memory to allocate for
                      buffering - defaults to 64MB

max_rate (float) OPTIONAL maximum sustained transfer rate for writes
            This is used to calculate optimal buffer size.  It does not need to
            be exact.

device (string) REQUIRED pathname to the UNIX tape device
                         for NULL movers make this /dev/null

dismount_delay (int) OPTIONAL delayed dismount value to use when none
                     specified by the client.  Also, the client cannot
                     reduce this amount - they can ask for longer
                     dismount delay, but this value is a minimum.
                     Defaults to 60 seconds.
                     Set to negative value to get "infinite" dismount
                     delay.
mount_delay (int) OPTIONAL number of seconds to wait after media
                  changer mount completes, before trying to open
                  device. Default is 15 for FTT driver, 0 for NULL
                  driver

library (string or list):  REQUIRED.  Who are we working for?  One or
                  more library manager names.

driver (string): REQUIRED.  Currently must be 'FTTDriver' or
                 'NullDriver', or else mover will complain at startup.
                 If we need a disk mover, this would be easy to hack
                 together; doesn't seem too useful though.

max_consecutive_failures: type int, default 2
                          Mover will declare itself "broken" if this
                          many successive transfers fail, and the
                          error was not ENCP_GONE
      
max_failures: type int, default 3
              Mover will declare itself "broken" if this many
              transfers fail within failure_interval (see below).
              Again, ENCP_GONE errors do not count

failure_interval: type int, default 3600 (one hour)
                  Interval for above.  
"""

